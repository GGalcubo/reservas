{% load static %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    {% include "sistema/cabecera.html" %}
    <body id="operaciones" class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-reversed page-sidebar-fixed page-md">
        {% include "sistema/barra_top.html" %}
        <!-- BEGIN HEADER & CONTENT DIVIDER -->
        <div class="clearfix"> </div>
        <!-- END HEADER & CONTENT DIVIDER -->
        <!-- BEGIN CONTAINER -->
        <div class="page-container">
            {% include "sistema/barra_lat.html" %}
            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                            <div class="portlet light ">
                                <div class="portlet-title">
                                    <div class="caption font-green">
                                        <i class="icon-rocket font-green"></i>
                                        <span class="caption-subject bold uppercase">Viajes en progreso</span>
                                    </div>
                                    <div class="tools"> </div>
                                </div>
                                <div class="portlet-body">
                                    <div id="cont_viajesEnProgreso">

                                    </div>
                                </div>
                            </div>
                            <!-- END EXAMPLE TABLE PORTLET-->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                            <div class="portlet light ">
                                <div class="portlet-title">
                                    <div class="caption font-green">
                                        <i class="icon-rocket font-green"></i>
                                        <span class="caption-subject bold uppercase">Viajes</span>
                                    </div>
                                    <!--<div class="inline-block width-50" style="float: right;">
                                        <select id="multiselect_estado" class="mt-multiselect btn btn-default" multiple="multiple" data-clickable-groups="true" data-drop-right="true" data-width="100%">
                                            <optgroup label="Nuevos" class="group-1">
                                                <option value="1-1">Sin asignar</option>
                                                <option value="1-2" selected="selected">Asignados</option>
                                                <option value="1-3" selected="selected">Confirmados</option>
                                                <option value="1-4" selected="selected">En progreso</option>
                                            </optgroup>
                                            <optgroup label="Finalizados" class="group-2">
                                                <option value="2-1">Cerrados</option>
                                                <option value="2-2">Cancelados</option>
                                            </optgroup>
                                        </select>
                                    </div>-->
                                </div>
                                <div class="portlet-body">
                                    <div id="cont_futurosViajes">

                                    </div>
                                </div>
                                <!-- </div> -->
                                <div class="tools"> </div>
                            </div>
                            <!-- END EXAMPLE TABLE PORTLET-->
                        </div>
                    </div>

                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
            <!-- BEGIN QUICK SIDEBAR -->
            <!-- END QUICK SIDEBAR -->
        </div>
        <!-- END CONTAINER -->
        {% include "sistema/footer.html" %}
            
            <!-- SCRIPTS PROPIOS DE ESTA VISTA -->
            <script>

                var viaje_seleccionado = '';

                $(document).ready(function(){
                    $('#viajesEnProgreso').DataTable( {
                        responsive: true,
                        colReorder: true,
                        select: true,
                        order: [[ 3, "asc" ]],
                        dom: 'Bfrtip',
                        buttons: [
                            {
                                extend: 'copy',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                            {
                                extend: 'excel',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                            {
                                extend: 'pdf',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                            {
                                extend: 'print',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                        ],
                        lengthMenu: [
                                        [ -1, 500, 100, 50, 25, 10 ],
                                        [ 'Todos', '500', '100', '50', '25', '10' ]
                                    ],
                        language: {
                            url: '//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json'
                        },
                        language: {
                            buttons: {
                                copy: "Copiar",
                                print: "Imprimir"
                            }
                        }
                    } );

                    $('#futurosViajes').DataTable( {
                        responsive: true,
                        colReorder: true,
                        dom: 'Bfrtip',
                        buttons: [
                            {
                                extend: 'copy',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                            {
                                extend: 'excel',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                            {
                                extend: 'pdf',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                            {
                                extend: 'print',
                                exportOptions: {
                                    columns: ':visible:not(:eq(0))'
                                }
                            },
                        ],
                        lengthMenu: [
                                        [ -1, 500, 100, 50, 25, 10 ],
                                        [ 'Todos', '500', '100', '50', '25', '10' ]
                                    ],
                        language: {
                            url: '//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json'
                        },
                        language: {
                            buttons: {
                                copy: "Copiar",
                                print: "Imprimir"
                            }
                        }
                    } );



                    getGrillasViajes($('#fechaDeHoy').val());

                    $('#fechaDeHoy').change(function () {
                        getGrillasViajes($('#fechaDeHoy').val());
                    });
                });


                $('#estado_asignado').css( 'cursor', 'pointer' );
                $('#estado_confirmado').css( 'cursor', 'pointer' );
                $('#estado_en_progreso').css( 'cursor', 'pointer' );
                $('#estado_cerrado').css( 'cursor', 'pointer' );
                $('#estado_cancelado').css( 'cursor', 'pointer' );

                $('#estado_asignado').click(function () {
                    //console.log('viaje_seleccionado: '+ viaje_seleccionado);
                    editEstadoViaje('1');
                });

                $('#estado_confirmado').click(function () {
                    //console.log('viaje_seleccionado: '+ viaje_seleccionado);
                    editEstadoViaje('4');
                });

                $('#estado_en_progreso').click(function () {
                    //console.log('viaje_seleccionado: '+ viaje_seleccionado);
                    editEstadoViaje('5');
                });

                $('#estado_cerrado').click(function () {
                    //console.log('viaje_seleccionado: '+ viaje_seleccionado);
                    editEstadoViaje('7');
                });

                $('#estado_cancelado').click(function () {
                    //console.log('viaje_seleccionado: '+ viaje_seleccionado);
                    //editEstadoViaje('1');
                });

                function editEstadoViaje(estado_seleccionado){

                    var url = "/sistema/editEstadoViaje/";
                    $.ajax({
                       type: "POST",
                       url: url,
                       headers: {'X-CSRFToken': '{{ csrf_token }}'},
                       data: {viaje_seleccionado:viaje_seleccionado, estado_seleccionado:estado_seleccionado},
                       success: function(data)
                       {
                           getGrillasViajes($('#fechaDeHoy').val());
                       }
                     });
                }

                function getGrillasViajes(fecha) {
                    var url = "/sistema/getViajesFuturosPorFecha/";
                    $.ajax({
                       type: "POST",
                       url: url,
                       headers: {'X-CSRFToken': '{{ csrf_token }}'},
                       data: {date:fecha},
                       success: function(data)
                       {
                           $('#cont_futurosViajes').html(data);
                       }
                     });

                    var url = "/sistema/getViajesEnProgresoPorFecha/";
                    $.ajax({
                       type: "POST",
                       url: url,
                       headers: {'X-CSRFToken': '{{ csrf_token }}'},
                       data: {date:fecha},
                       success: function(data)
                       {
                           $('#cont_viajesEnProgreso').html(data);
                       }
                     });
                }
            </script>

        </div>
    </body>

</html>