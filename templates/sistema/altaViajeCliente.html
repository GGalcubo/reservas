{% load static %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="es">
    <!--<![endif]-->
    {% include "sistema/cabecera.html" %}
    <link href="{% static 'css/viajeStyle.css' %}" rel="stylesheet" type="text/css" />
    <!-- <link href="{% static 'css/select2.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'css/select2-bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'css/jquery.fancybox.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'css/bootstrap-fileinput.min.css' %}" rel="stylesheet" type="text/css" /> -->
    <style>
        .tabbable-line > .tab-content {
                padding: 10px 0!important;
        }
        .disabled-select {
           background-color:#d5d5d5;
           opacity:0.5;
           border-radius:3px;
           cursor:not-allowed;
           position:absolute;
           top:0;
           bottom:0;
           right:0;
           left:0;
        }
    </style>
    <body id="viajes" class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-reversed page-sidebar-fixed page-md">
    {% include "sistema/barra_top.html" %}
        <div class="page-container">

            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <i class="icon-home"></i>
                                <a href="/sistema/operaciones/">Operaciones</a>
                                <i class="fa fa-angle-right"></i>
                            </li>
                            <li>
                                <span>Viaje</span>
                            </li>
                        </ul>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="portlet light ">
                                <div class="portlet-title">
                                    <div class="caption font-green">
                                        <span class="caption-subject bold uppercase" id="viaje_titulo"><i class="icon-rocket font-green mg-r-5"></i>Datos del Pasajero y del Viaje</span>
                                        <a href="#" class="btn blue mg-r-10 mg-b-5 guardar_viaje" type="submit">Guardar</a>
                                    </div>
                                    <div class="tools"></div>
                                </div>
                                <div class="portlet-body">
                                    <form role="form" class="form-viaje-viaje" id="form-viaje-viaje" method="post" action="/sistema/guardarViaje/">{% csrf_token %}
                                        <div class="form-body">
                                            <div class="row flex mg-b-10">
                                                <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control" id="nombre_pasajero" name="nombre_pasajero" value="">
                                                        <label for="nombre_pasajero">Nombre y Apellido</label>
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 col-sm-4 col-md-3 col-lg-3">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control" id="dni_pasajero" name="dni_pasajero" value="">
                                                        <label for="dni_pasajero">DNI</label>
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 col-sm-4 col-md-3 col-lg-3">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control" id="celular_pasajero" name="celular_pasajero" value="">
                                                        <label for="celular_pasajero">Celular</label>
                                                    </div>
                                                </div>
                                                <div class="col-xs-12 col-sm-6 col-md-8 col-lg-8">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="email" class="form-control" id="email_pasajero" name="email_pasajero" value="">
                                                        <label for="email_pasajero">E-mail</label>
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 col-sm-2 col-md-4 col-lg-4">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="number" min="1" max="99" class="form-control" id="cant_pasajeros" name="cant_pasajeros" value="">
                                                        <label for="cant_pasajeros">Cant. Pax</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="row flex mg-b-10">
                                                <div class="col-xs-6 col-sm-2 col-md-2 col-lg-1">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control" id="fecha" value="" name="fecha" autocomplete="off" style="cursor: pointer !important;">
                                                        <label for="fecha">Fecha</label>
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 col-sm-2 col-md-2 col-lg-1">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control timepicker timepicker-24" id="hora" value="" name="hora" style="cursor: pointer !important;">
                                                        <label for="hora">Hora</label>
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 col-sm-2 col-md-2 col-lg-1">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control" id="maletas" name="maletas">
                                                            <option value="0">0</option>
                                                            <option value="1">1</option>
                                                            <option value="2">2</option>
                                                            <option value="3">3</option>
                                                            <option value="4">4</option>
                                                            <option value="5">5</option>
                                                            <option value="6">6</option>
                                                            <option value="7">7</option>
                                                            <option value="8">8</option>
                                                            <option value="9">9</option>
                                                            <option value="10">10</option>
                                                        </select>
                                                        <label for="maletas">Cant. Maletas</label>
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 col-sm-2 col-md-2 col-lg-1">
                                                    <div class="form-group form-md-checkboxes">
                                                        <div class="md-checkbox-inline">
                                                            <div class="md-checkbox">
                                                                <input type="checkbox" id="bilingue" class="md-check" name="bilingue">
                                                                <label for="bilingue">
                                                                    <span></span>
                                                                    <span class="check"></span>
                                                                    <span class="box"></span> Bilingue
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3">
                                                    <div class="form-group form-md-line-input">
                                                        <textarea class="form-control" rows="2" placeholder="Dejanos cualquier comentario o aclaración" name="comentario_pasajero" id="comentario_pasajero"></textarea>
                                                        <label for="comentario_pasajero">Comentario</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="row flex align-i-center mg-t-20">
                                                <div class="col-xs-12 col-sm-6 mg-b-10">
                                                    <div class="row">
                                                        <div class="col-xs-12">
                                                            <div class="caption font-green" style="margin:0 auto;margin-bottom: 10px;text-align: center">
                                                                <span class="caption-subject bold uppercase" style="font-size: 16px">Desde</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-xs-12 col-sm-12 col-md-6">
                                                            <div class="form-group form-md-line-input">
                                                                <select class="form-control select2me" id="desde_destino" name="desde_destino">
                                                                    <option value=""></option>
                                                                    {{% for p in provincias %}
                                                                        {% if p.id == viaje.getTrayectoPrincipal.provincia_desde_id %}
                                                                            <option selected="selected" value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% else %}
                                                                            <option value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                                <label>Provincia</label>
                                                            </div>
                                                        </div>
                                                        <!-- <div class="col-xs-12 col-sm-12 col-md-6 cont_desde_localidad">
                                                            <div class="form-group form-md-line-input">
                                                                <select class="form-control select2me" id="desde_localidad" name="desde_localidad">
                                                                    <option value=""></option>
                                                                    {% for l in localidades %}
                                                                        {% if l.id == viaje.getTrayectoPrincipal.localidad_desde_id %}
                                                                            <option selected="selected" value="{{ l.id }}">{{ l.nombre }}</option>
                                                                        {% else %}
                                                                            <option value="{{ l.id }}">{{ l.nombre }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                                <label>Localidad</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-xs-12 col-sm-12 col-md-6 cont_desde_provincia">
                                                            <div class="form-group form-md-line-input">
                                                                <select class="form-control select2me" id="desde_provincia" name="desde_provincia">
                                                                    <option value=""></option>
                                                                    {% for p in provincias %}
                                                                        {% if p.id == viaje.getTrayectoPrincipal.provincia_desde_id %}
                                                                            <option selected="selected" value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% else %}
                                                                            <option value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                                <label>Provincia</label>
                                                            </div>
                                                        </div> -->
                                                    </div>
                                                    <div class="desde_direccion">
                                                        <div class="row">
                                                            <div class="col-xs-12 col-sm-12 col-md-8">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_calle" name="desde_calle" value="{{ viaje.getTrayectoPrincipal.calle_desde }}">
                                                                    <label>Calle</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6 col-sm-6 col-md-4">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_altura" name="desde_altura" value="{{ viaje.getTrayectoPrincipal.altura_desde }}">
                                                                    <label>Altura</label>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="col-xs-6 col-sm-12 col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_entre" name="desde_entre" value="{{ viaje.getTrayectoPrincipal.entre_desde }}">
                                                                    <label>Campo Auxiliar</label>
                                                                </div>
                                                            </div> -->
                                                        </div>
                                                    </div>
                                                    <!-- <div class="desde_vuelo">
                                                        <div class="row">
                                                            <div class="col-xs-6 col-sm-12 col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_compania" name="desde_compania" value="{{ viaje.getTrayectoPrincipal.compania_desde }}">
                                                                    <label>Compania</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6 col-sm-12 col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_vuelo" name="desde_vuelo" value="{{ viaje.getTrayectoPrincipal.vuelo_desde }}">
                                                                    <label>Número de Vuelo</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> -->
                                                </div>
                                                <!-- <div class="col-xs-12 col-sm-2 flex flex-j-center mg-b-10">
                                                    <a id="revert" href="javascript:;" class="btn btn-lg blue btn-outline"><i class="icon-refresh"></i></a>
                                                </div> -->
                                                <div class="col-xs-12 col-sm-6 mg-b-10">
                                                    <div class="row">
                                                        <div class="col-xs-12">
                                                            <div class="caption font-green" style="margin:0 auto;margin-bottom: 10px;text-align: center">
                                                                <span class="caption-subject bold uppercase" style="font-size: 16px">Hasta</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-xs-12 col-sm-12 col-md-6">
                                                            <div class="form-group form-md-line-input">
                                                                <select class="form-control select2me" id="hasta_destino" name="hasta_destino">
                                                                    <option value=""></option>
                                                                    {% for p in provincias %}
                                                                        {% if p.id == viaje.getTrayectoPrincipal.provincia_hasta_id %}
                                                                            <option selected="selected" value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% else %}
                                                                            <option value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                                <label>Provincia</label>
                                                            </div>
                                                        </div>
                                                        <!-- <div class="col-xs-12 col-sm-12 col-md-6 cont_hasta_localidad">
                                                            <div class="form-group form-md-line-input">
                                                                <select class="form-control select2me" id="hasta_localidad" name="hasta_localidad">
                                                                    <option value=""></option>
                                                                    {% for l in localidades %}
                                                                        {% if l.id == viaje.getTrayectoPrincipal.localidad_hasta_id %}
                                                                            <option selected="selected" value="{{ l.id }}">{{ l.nombre }}</option>
                                                                        {% else %}
                                                                            <option value="{{ l.id }}">{{ l.nombre }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                                <label>Localidad</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-xs-12 col-sm-12 col-md-6 cont_hasta_provincia">
                                                            <div class="form-group form-md-line-input">
                                                                <select class="form-control select2me" id="hasta_provincia" name="hasta_provincia">
                                                                    <option value=""></option>
                                                                    {% for p in provincias %}
                                                                        {% if p.id == viaje.getTrayectoPrincipal.provincia_hasta_id %}
                                                                            <option selected="selected" value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% else %}
                                                                            <option value="{{ p.id }}">{{ p.nombre }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                                <label>Provincia</label>
                                                            </div>
                                                        </div> -->
                                                    </div>
                                                    <div class="hasta_direccion">
                                                        <div class="row">
                                                            <div class="col-xs-12 col-sm-12 col-md-8">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_calle" name="hasta_calle" value="{{ viaje.getTrayectoPrincipal.calle_hasta }}">
                                                                    <label>Calle</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6 col-sm-6 col-md-4">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_altura" name="hasta_altura" value="{{ viaje.getTrayectoPrincipal.altura_hasta }}">
                                                                    <label>Altura</label>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="col-xs-6 col-sm-12 col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_entre" name="hasta_entre" value="{{ viaje.getTrayectoPrincipal.entre_hasta }}">
                                                                    <label>Campo Auxiliar</label>
                                                                </div>
                                                            </div> -->
                                                        </div>
                                                    </div>
                                                    <!-- <div class="hasta_vuelo">
                                                        <div class="row">
                                                            <div class="col-xs-6 col-sm-12 col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_compania" name="hasta_compania" value="{{ viaje.getTrayectoPrincipal.compania_hasta }}">
                                                                    <label>Compania</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6 col-sm-12 col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_vuelo" name="hasta_vuelo" value="{{ viaje.getTrayectoPrincipal.vuelo_hasta }}">
                                                                    <label>Número de Vuelo</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> -->
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="form-footer flex mg-t-10">
                                        <button href="#" class="btn blue mg-r-10 mg-b-5" type="submit">Guardar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="prueba"></div>

        {% include "sistema/footer.html" %}
        <!-- SCRIPTS PROPIOS DE ESTA VISTA -->
        {#<script src="{% static 'js/select2.full.min.js' %}" type="text/javascript"></script>#}
        <script src="{% static 'js/components-date-time-pickers.min.js' %}" type="text/javascript"></script>
        <!-- <script src="{% static 'js/bootstrap-fileinput.min.js' %}" type="text/javascript"></script> -->

        <script>
            var getUrlParameter = function getUrlParameter(sParam) {
                var sPageURL = window.location.search.substring(1),
                    sURLVariables = sPageURL.split('&'),
                    sParameterName,
                    i;

                for (i = 0; i < sURLVariables.length; i++) {
                    sParameterName = sURLVariables[i].split('=');

                    if (sParameterName[0] === sParam) {
                        return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                    }
                }
            };
            let idViaje = getUrlParameter('idViaje');
            if(idViaje === undefined){
                $(document).prop('title', 'Nuevo viaje - Central LT');
            } else {
                $(document).prop('title', 'Viaje '+ idViaje+' - Central LT');
            }

            var clientes = [];
            /*{% for cliente in clientes %}
                var centro_costos = [{% for cc in cliente.centrocosto_set.all %}
                { "id" : "{{ cc.id }}",
                   "nombre" : "{{ cc.nombre }}"
                },
                {% endfor %}
                ];
                var personascliente = [{% for personacliente in cliente.personacliente_set.all %}
                { "id" : "{{ personacliente.persona.id }}",
                   "nombre" : "{{ personacliente.persona.apellido}} {{ personacliente.persona.nombre}} ",
                   "tipo_persona" : "{{ personacliente.persona.tipo_persona}}",
                   "telefono" : "{{ personacliente.persona.telefono}}"
                },
                {% endfor %}
                ];

                var obj = {
                    id : '{{ cliente.id }}',
                    razon_social:'{{ cliente.razon_social }}',
                    direccion:'{{ cliente.calle|default_if_none:""  }} {{ cliente.altura|default_if_none:""  }} {{ cliente.piso|default_if_none:""  }} {{ cliente.depto|default_if_none:""  }}',
                    categoria_id:'{{ cliente.categoria.categoria }}',
                    telefono:'{{ cliente.telefonoPrincipal }}',
                    centro_costos: centro_costos,
                    personascliente: personascliente};

                clientes.push(obj);
            {% endfor %}*/

            var unidades = [];
            {% for unidad in unidades %}
                var obj = {
                    id : '{{ unidad.0 }}',
                    id_fake : '{{ unidad.1 }}',
                    identificacion:'{{ unidad.2 }}'};
                unidades.push(obj);
            {% endfor %}

            var tipo_observaciones = [];
            {% for to in tipoobservacion %}
                var obj = {
                    id : '{{ to.id }}',
                    tipo_observacion : '{{ to.tipo_observacion }}',
                    detalle_tipo_obs:'{{ to.detalle_tipo_obs|default_if_none:"" }}'};
                tipo_observaciones.push(obj);
            {% endfor %}

            var estados = [];
            {% for estado in estados %}
                var obj = {
                    id : '{{ estado.id }}',
                    identificacion:'{{ estado.estado }}'};
                estados.push(obj);
            {% endfor %}

            var provincias = [];
            {% for provincia in provincias %}
                var obj = {
                    id : '{{ provincia.id }}',
                    nombre:'{{ provincia.nombre }}'};
                provincias.push(obj);
            {% endfor %}

            var localidades = [];
            {% for localidad in localidades %}
                var obj = {
                    id : '{{ localidad.id }}',
                    provincia : '{{ localidad.provincia }}',
                    terminal_flag : '{{ localidad.terminal_flag }}',
                    nombre:'{{ localidad.nombre }}'};
                localidades.push(obj);
            {% endfor %}

            /*var categoria_viajes = [];
            {% for categoria_viaje in categoria_viajes %}
                var obj = {
                    id : '{{ categoria_viaje.id }}',
                    codigo : '{{ categoria_viaje.codigo }}',
                    categoria:'{{ categoria_viaje.categoria }}'};
                categoria_viajes.push(obj);
            {% endfor %}*/

            var viaje_items = [];
            {% for viaje_item in viaje.getViajeItems %}
                var obj = {
                    id : '{{ viaje_item.id }}',
                    monto : '{{ viaje_item.monto }}',
                    monto_s_iva : '{{ viaje_item.monto_s_iva }}',
                    monto_iva : '{{ viaje_item.monto_iva }}',
                    tipo_items_viaje : '{{ viaje_item.tipo_items_viaje_id }}',
                    cant:'{{ viaje_item.cant }}'};
                viaje_items.push(obj);
            {% endfor %}

            var es_nuevo            = '{{ es_nuevo }}';
            var mensaje             = '{{ mensaje }}';
            var viaje               = '{{ viaje.id }}';
            var estado              = '{{ viaje.estado.id }}';
            var espera_viaje        = '{{ viaje.espera|default_if_none:"" }}';
            var maletas_viaje       = '{{ viaje.maletas|default_if_none:"" }}';
            var bilingue_viaje      = '{{ viaje.bilingue|default_if_none:"" }}';
            var dispo_viaje         = '{{ viaje.dispo|default_if_none:"" }}';
            var pasajero_cant       = '{{ viaje.nropasajeros|default_if_none:"" }}';
            var solicitante         = '{{ viaje.solicitante.id }}';
            var pasajero            = '{{ viaje.pasajero.id }}';
            var centro_costo        = '{{ viaje.centro_costo.id }}';
            var html_select         = '';

            var cliente_id          = '{{ viaje.cliente.id|default_if_none:"" }}';
            var cliente             = '';

            var destino_desde_id    = '{{ viaje.getTrayectoPrincipal.destino_desde_id|default_if_none:"" }}';
            var provincia_desde_id  = '{{ viaje.getTrayectoPrincipal.provincia_desde_id|default_if_none:"" }}';
            var localidad_desde_id  = '{{ viaje.getTrayectoPrincipal.localidad_desde_id|default_if_none:"" }}';

            var destino_hasta_id    = '{{ viaje.getTrayectoPrincipal.destino_hasta_id|default_if_none:"" }}';
            var provincia_hasta_id  = '{{ viaje.getTrayectoPrincipal.provincia_hasta_id|default_if_none:"" }}';
            var localidad_hasta_id  = '{{ viaje.getTrayectoPrincipal.localidad_hasta_id|default_if_none:"" }}';

            var csrf_token          = '{{ csrf_token }}';
            var uid                 = '{{ uid }}';
            var is_clone            = '{{ is_clone }}';
            var permiso             = '{{ permiso }}';


            function exportarPdf( e, dt, node, config ){
                // var table = $('#tablaListadoFactClientes').DataTable();
                // var selectedRows = table.rows().ids(true);
                // var ids = "";
                // for (var i = 0; i < selectedRows.length; i++) {
                //     ids = ids + selectedRows[i].replace("#rowid","") + "-"
                // }

                // var params = '<input type="hidden" name="cliente" value="'+$("#cliente").val()+'">';
                // params += '<input type="hidden" name="desde" value="'+$("#desde").val()+'">';
                // params += '<input type="hidden" name="hasta" value="'+$("#hasta").val()+'">';
                // params += '<input type="hidden" name="ids" value="'+ids+'">';
                // params += '<input type="hidden" name="centrosCosto" value="'+$("#centroDeCosto").val()+'">';

                $("#formularioPdf").html('');
                $("#formularioPdf").html('<form id="dynForm" target="_blank" action="/sistema/exportarPdfViaje/" method="get">'+params+'</form>');
                $("#dynForm").submit();
            }
        </script>

        <script src="{% static 'js/viaje.js' %}" type="text/javascript"></script>

        {% include "sistema/template_upload.html" %}
    </body>
</html>
