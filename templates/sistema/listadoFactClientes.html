{% load static %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="es">
    <!--<![endif]-->
    {% include "sistema/cabecera.html" %}
    <body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-reversed page-sidebar-fixed page-md">
        {% include "sistema/barra_top.html" %}
        <div class="page-container">
            {% include "sistema/barra_lat.html" %}
            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                  <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <i class="icon-directions"></i>
                                <a href="/sistema/operaciones/">Operaciones</a>
                                <i class="fa fa-angle-right"></i>
                            </li>
                            <li>
                                <span>Listado de Facturas de Clientes</span>
                            </li>
                        </ul>
                    </div>
                    <div class="row">
                        <div id="" class="col-sm-12">
                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                            <div class="portlet light ">
                              <div class="portlet-title">
                                  <div class="caption font-blue">
                                      <i class="icon-briefcase font-blue"></i>
                                      <span class="caption-subject bold uppercase">Facturas de Clientes</span>
                                  </div>
                                  <div class="tools"> </div>
                              </div>
                              <div class="portlet-body">
                                  <form role="form" method="post" id="formFacturacionCliente" action="">
                                      <div class="form-body">
                                          <div class="row">
                                            <div class="col-sm-4">
                                                <div class="form-group mg-b-10">
                                                    <label class="control-label mg-b-0" style="color: #888;">Fecha</label>
                                                    <div class="input-group date-picker input-daterange" data-date-format="dd/mm/yyyy">
                                                      <input type="text" class="form-control" name="desde" id="desde">
                                                      <span class="input-group-addon" style="font-size: 10px;"> hasta </span>
                                                      <input type="text" class="form-control" name="hasta" id="hasta">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-3">
                                              <div class="form-group form-md-line-input">
                                                <select class="form-control select2me" id="cliente" name="cliente" onchange="cambioCliente();">
                                                  <option value="">Seleccionar Cliente</option>
                                                  {% for c in clientes %}
                                                    <option value="{{c.id}}">{{c.id}} - {{c.razon_social}}</option>
                                                  {% endfor %}
                                                </select>
                                                <label for="cliente">Cliente</label>
                                              </div>
                                            </div>
                                            <div class="col-sm-2" >
                                              <div class="form-group form-md-line-input" id="selectCentroCostos">
                                                <select class="form-control select2me" id="centroDeCosto" name="centroDeCosto" multiple="multiple">
                                                    <option value="">Seleccionar CC</option>
                                                    {% for c in centrosCosto %}
                                                        <option value="{{c.id}}">{{c.id}} - {{c.nombre}}</option>
                                                    {% endfor %}                                                    
                                                </select>
                                                <label for="centroDeCosto">Centro de Costo</label>
                                              </div>
                                            </div>
                                            <div class="col-sm-3">
                                              <div class="form-group form-md-line-input">
                                                <select class="form-control select2me" id="categViaje" name="categViaje" multiple="multiple">
                                                  {% for c in categorias %}
                                                    <option value="{{c.id}}">{{c.categoria}}</option>
                                                  {% endfor %}
                                                </select>
                                                <label for="categViaje">Categ. Viaje</label>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="row">
                                            <div class="col-sm-3">
                                                <div class="form-group form-md-line-input">
                                                    <select class="form-control select2me" id="estado" name="estado" multiple="multiple">
                                                    {% for e in estados %}
                                                        <option value="{{ e.id }}">{{ e.estado }}</option>
                                                    {% endfor %}
                                                    </select>
                                                    <label for="estado">Seleccionar Estado</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-3">
                                              <div class="form-group form-md-line-input">
                                                <select class="form-control select2me" id="condEspecial" name="condEspecial">
                                                  <option value="">Seleccionar Condicion Especial</option>
                                                  <option value="1">Sin estacionamiento</option>
                                                  <option value="2">Con estacionamiento</option>
                                                  <option value="3">Servicios sin IVA</option>
                                                  <option value="4">Servicios con IVA</option>
                                                  <option value="5">Viajes abiertos</option>
                                                </select>
                                                <label for="condEspecial">Cond. Especial</label>
                                              </div>
                                            </div>
                                            <div class="col-sm-2">
                                              <div class="form-group form-md-line-input"  id="selectSolicitante">
                                                <select class="form-control select2me" id="solicitantes" name="solicitantes" multiple="multiple">
                                                  <option value=""></option>
                                                </select>
                                                <label for="solicitantes">Solicitante</label>
                                              </div>
                                            </div>
                                            <div class="col-sm-2">
                                              <div class="form-group form-md-line-input" id="selectProforma">
                                                <select class="form-control select2me" id="proforma" name="proforma" multiple="multiple">
                                                  <option value="0">Sin proforma</option>
                                                </select>
                                                <label for="proforma">Proforma</label>
                                              </div>
                                            </div>
                                            <div class="col-sm-2">
                                              <div class="form-group form-md-line-input" id="selectFactura">
                                                <select class="form-control select2me" id="factura" name="factura" multiple="multiple">
                                                  <option value="0">Sin factura</option>
                                                </select>
                                                <label for="factura">Factura</label>
                                              </div>
                                            </div>
                                          </div>
                                      </div>
                                      <div class="form-actions noborder flex">
                                          <button type="button" onclick="buscarFacturacion();" class="btn green mg-r-10">Buscar</button>
                                          <button type="button" onclick="resetFiltros();" class="btn blue btn-outline">Resetear filtros</button>
                                      </div>
                                  </form>
                              </div>
                              <hr>
                              <!-- <div class="flex flex-j-end">
                                  <button type="button" onclick="openFacturar();" class="btn green btn-outline mg-r-10 mg-b-5">Facturar</button>
                                  <button type="button" onclick="asignarProforma();" class="btn blue mg-b-5">Asignar N° proforma</button>
                              </div> -->
                              <div class="portlet-body" id="grillaFacturacion">
                                  <table class="table table-striped table-bordered table-hover dt-responsive" width="100%" id="tablaListadoFactClientes">
                                      <thead>
                                          <tr>
                                              <th class="all"></th>
                                              <th class="all">Fecha</th>
                                              <th class="all">TS</th>
                                              <th class="all">Hora</th>
                                              <th class="all">Unidad</th>
                                              <th class="all">N° Serv</th>
                                              <th class="all">ID Aux</th>
                                              <th class="all">Proforma</th>
                                              <th class="all">Factura</th>
                                              <th class="all">Solicitante</th>
                                              <th class="all">Centro Costo</th>
                                              <th class="all">Pasajero</th>
                                              <th class="all">Origen</th>
                                              <th class="all">Destino</th>
                                              <th class="all">Hs Dispo</th>
                                              <th class="all">Dispo</th>
                                              <th class="all">Subtotal</th>
                                              <th class="all">P. Efect</th>
                                              <th class="all">T. Espera</th>
                                              <th class="all">Espera</th>
                                              <th class="all">Bilingue</th>
                                              <th class="all">Maletas</th>
                                              <th class="all">Peajes</th>
                                              <th class="all">Parking</th>
                                              <th class="all">Otros</th>
                                              <th class="all">Total</th>
                                              <th class="all">I.V.A.</th>
                                              <th class="all">Final</th>
                                              <th class="all">ID</th>
                                          </tr>
                                      </thead>
                                      <tbody>
                                          
                                      </tbody>
                                      <!-- ESTO SE AGREGO PARA LA FILA DE TOTAL -->
                                      <tfoot>
                                          <tr>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                              <th></th>
                                          </tr>
                                      </tfoot>
                                      <!-- HASTA ACA -->
                                  </table>
                              </div>
                              <div class="flex flex-j-start">
                                  <button type="button" onclick="asignarProforma();" class="btn green mg-r-10 mg-b-5">Asignar N° proforma</button>
                                  <button type="button" onclick="openFacturar();" class="btn blue btn-outline mg-b-5">Facturar</button>
                              </div>
                          </div>
                            <!-- END EXAMPLE TABLE PORTLET-->
                        </div>
                    </div>

                </div>

                <form role="form" method="post" id="facturarClientes" action="">
                <input type="hidden" class="form-control" id="idViajes" name="idViajes">
                <div id="facturarClientesModal" class="modal fade" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                            <h4 class="modal-title" style="color:#888;">Facturar Clientes</h4>
                        </div>
                        <div class="modal-body">
                            <div class="scroller" style="height: 100px;" data-always-visible="1" data-rail-visible1="1">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group form-md-line-input form-md-floating-label">
                                            <input type="text" class="form-control" id="primernumeroFactura" name="primernumeroFactura" onchange="completarPrimerNumeroFactura();" maxlength="4">
                                            <label for="primernumeroFactura">Pto. Venta (0001)</label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="form-group form-md-line-input form-md-floating-label">
                                            <input type="text" class="form-control" id="numeroFactura" name="numeroFactura" maxlength="8" onchange="completarNumeroFactura();">
                                            <label for="numeroFactura">Número de Factura (00000001)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer noborder flex">
                            <button type="button" onclick="guardarNumeroFactura();" class="btn green">Guardar</button>
                            <button type="button" class="btn red btn-outline" data-dismiss="modal">Cancelar</button>
                        </div>
                    </div>
                    </div>
                </div>
                </form>
                <div id="formularioPdf"></div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
            <!-- BEGIN QUICK SIDEBAR -->
            <!-- END QUICK SIDEBAR -->
        </div>
        <!-- END CONTAINER -->
        {% include "sistema/footer.html" %}

            <!-- SCRIPTS PROPIOS DE ESTA VISTA -->
            <script>
                $(document).ready(function(){
                    $(document).prop('title', 'Listado Facturación Clientes - Central LT');
                    let table = $('#tablaListadoFactClientes').DataTable( {
                        ///////////////// EJEMPLO DE DATATABLES CON TABLE FOOTER PARA FILAS CON TOTAL /////////////
                        /*
                        Se puede usar esto que entiendo es una API de datatables o bien clavar una ultima fila y que algún
                        método haga la magia de sumar los valores de las filas anteriores. Como diría Jelinek, lo dejo a tu
                        criterio.
                        */
                        "footerCallback": function ( row, data, start, end, display ) {
                            var api = this.api(), data;
                
                            // Remove the formatting to get integer data for summation
                            var intVal = function ( i ) {
                                return typeof i === 'string' ?
                                    i.replace(/[\$,]/g, '')*1 :
                                    typeof i === 'number' ?
                                        i : 0;
                            };
               
                            // Total over all pages
                            total15 = api.column( 15 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total16 = api.column( 16 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total17 = api.column( 17 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total18 = api.column( 18 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total19 = api.column( 19 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total20 = api.column( 20 ).data() .reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total21 = api.column( 21 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total22 = api.column( 22 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total23 = api.column( 23 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total24 = api.column( 24 ).data().reduce( function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0 );
                            total25 = api.column( 25 ).data().reduce( function (a, b) {
                                return parseFloat(a) + parseFloat(b.replace("$","").replace(",","."));
                            }, 0 );
                            total26 = api.column( 26 ).data().reduce( function (a, b) {
                                return parseFloat(a) + parseFloat(b.replace("$","").replace(",","."));
                            }, 0 );
               
                            // Update footer
                            $( api.column( 15 ).footer() ).html('$'+ total15);
                            $( api.column( 16 ).footer() ).html('$'+ total16);
                            $( api.column( 17 ).footer() ).html(total17);
                            $( api.column( 18 ).footer() ).html('$'+ total18);
                            $( api.column( 19 ).footer() ).html('$'+ total19);
                            $( api.column( 20 ).footer() ).html('$'+ total20);
                            $( api.column( 21 ).footer() ).html('$'+ total21);
                            $( api.column( 22 ).footer() ).html('$'+ total22);
                            $( api.column( 23 ).footer() ).html('$'+ total23);
                            $( api.column( 24 ).footer() ).html('$'+ total24);
                            $( api.column( 25 ).footer() ).html('$'+ total25);
                            $( api.column( 26 ).footer() ).html('$'+ total26);
                        },
                      //////////////// HASTA ACA HARDCODEADO EL TOTAL SEGUN EL EJEMPLO DE DATATABLES //////////////

                      //////////////////// ESTO PARA QUE EL SCROLL ESTÉ DESPUÉS DEL FOOTER ////////////////////////
                      "fnInitComplete": function(){
                          // Disable TBODY scoll bars
                          $('.dataTables_scrollBody').css({
                              'overflow': 'hidden',
                              'border': '0'
                          });

                          // Enable TFOOT scoll bars
                          $('.dataTables_scrollFoot').css('overflow', 'auto');

                          // Sync TFOOT scrolling with TBODY
                          $('.dataTables_scrollFoot').on('scroll', function () {
                              $('.dataTables_scrollBody').scrollLeft($(this).scrollLeft());
                          });                    
                      },
                      ////////////////////////////// HASTA ACA LO DEL FOOTER ///////////////////////////////////
                      colReorder: true,
                      responsive: true,
                      scrollX: true,
                      columnDefs: [ {
                          orderable: false,
                          className: 'select-checkbox',
                          targets:   0
                      },
                      {
                          targets: 26,
                          visible: false,
                          name: "ID"
                      },
                        /*{
                            targets: 8,
                            visible: false,
                            name: "factura"
                        },*/
                        {
                            targets: 4,
                            visible: false,
                            name: "unidad"
                        } ,
                        {
                            targets: 6,
                            visible: false,
                            name: "id_aux"
                        }],
                      select: {
                          style:    'os',
                          selector: 'td:first-child'
                      },
                      order: [[ 1, "asc" ]],
                      dom: 'lfBrtip',
                      buttons: [
                          'selectAll',
                          'selectNone',
                          {
                              extend: 'copyHtml5',
                              exportOptions: {
                                  columns: ':visible:not(:eq(0))'
                              }
                          },
                          {
                              extend: 'excelHtml5',
                              exportOptions: {
                                  columns: ':visible:not(:eq(0))'
                              }
                          },
                          /*{
                              extend: 'pdfHtml5',
                              orientation: 'landscape',
                              pageSize: 'TABLOID',
                              exportOptions: {
                                  columns: [ 1, 2, 3, 5, 6, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26 ]
                              },
                              customize: function(doc) {
                                doc.defaultStyle.fontSize = 8;
                             }
                          },*/
                          {
                              extend: 'print',
                              messageTop: 'Facturación Provedores',
                              exportOptions: {
                                  columns: ':visible:not(:eq(0))'
                              }
                          }
                      ],
                      lengthMenu: [
                                      [ 100, 50, 25, 10, -1 ],
                                      [ '100', '50', '25', '10', 'Todos' ]
                                  ],
                      pageLength: 10,
                      language: {
                          url: '//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json',
                          buttons: {
                              copy: "Copiar",
                              print: "Imprimir",
                              selectAll: "Seleccionar Todo",
                              selectNone: "Deseleccionar"
                          }
                      },
                        
                    });

                    $('#desde').datepicker({
                        language: 'es',
                        dateFormat: 'dd/mm/yy',
                        // todayBtn: true,
                        todayHighlight: true,
                        autoclose: true
                    });

                    $('#hasta').datepicker({
                        language: 'es',
                        dateFormat: 'dd/mm/yy',
                        // todayBtn: true,
                        todayHighlight: true,
                        autoclose: true
                    });

                    $("#cliente").select2({
                        placeholder: "Seleccionar Cliente",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#centroDeCosto").select2({
                        placeholder: "Seleccionar Centro Costo",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#estado").select2({
                        placeholder: "Seleccionar Estados",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#categViaje").select2({
                        placeholder: "Seleccionar Categoria",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#solicitantes").select2({
                        placeholder: "Seleccionar Solicitante",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#condEspecial").select2({
                        placeholder: "Seleccionar Condición Especial",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#factura").select2({
                        placeholder: "Seleccionar Nro. Facturas",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#proforma").select2({
                        placeholder: "Seleccionar Nro. Proforma",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                });

                function cambioCliente(){
                    cod = $("#cliente").val();
                    //cargarCentrosDeCosto(cod);
                    cargarFactura(cod);
                    cargarProforma(cod);
                    cargarSolicitante(cod);
                }

                function buscarFacturacion(){

                    if ($("#proforma").val() != "0" && $("#factura").val() != "0"){
                        if ($("#cliente").val() == "" && $("#centroDeCosto").val() == null){
                            alert("Debe seleccionar un Cliente o un Centro de Costo.");
                            return false;
                        }
                    }
                    if ($('#desde').val() == ""){
                        alert("El campo Fecha desde es obligatorio.")
                        return false;
                    }
                    if ($('#hasta').val() == ""){
                        alert("El campo Fecha hasta es obligatorio.")
                        return false;
                    }

                    desde = $('#desde').val().substring(6,10) + $('#desde').val().substring(3,5) + $('#desde').val().substring(0,2);
                    hasta = $('#hasta').val().substring(6,10) + $('#hasta').val().substring(3,5) + $('#hasta').val().substring(0,2);

                    if (desde.localeCompare(hasta) == 1 ){
                        alert("La fecha desde no puede ser mayor a la fecha hasta.")
                        return false;
                    }

                    var params = "categorias="+$("#categViaje").val();
                    params += "&centroDeCosto="+$("#centroDeCosto").val();
                    params += "&estados="+$("#estado").val();
                    params += "&condEspecial="+$("#condEspecial").val();
                    params += "&solicitantes="+$("#solicitantes").val();
                    params += "&facturas="+$("#factura").val();
                    params += "&proformas="+$("#proforma").val();
                    params += "&cliente="+$("#cliente").val();
                    params += "&desde="+$("#desde").val();
                    params += "&hasta="+$("#hasta").val();

                    var url = "/sistema/buscarFacturacionCliente/";
                    $.ajax({
                        type: "POST",
                        url: url,
                        headers: {'X-CSRFToken': '{{ csrf_token }}'},
                        data: params,
                        success: function(data){
                            $('#grillaFacturacion').html(data);
                        }
                    });
                }

                function resetFiltros(){
                    $('#desde').val("");
                    $('#hasta').val("");
                    var table = $('#tablaListadoFactClientes').DataTable();
                    table.clear().draw();
                    $("#cliente").val('').trigger('change')
                    $("#estado").val('').trigger('change')
                    cambioCliente();
                    cargarCentrosDeCosto();
                }

                function cargarCentrosDeCosto(){
                    var url = "/sistema/cargarCentrosDeCosto/";
                    $.ajax({
                        type: "GET",
                        url: url,
                        success: function(data){
                            $('#selectCentroCostos').html(data);
                        }
                    });
                }

                function cargarSolicitante(codCli){
                    var url = "/sistema/cargarSolicitante/?idCliente="+codCli;
                    $.ajax({
                        type: "GET",
                        url: url,
                        success: function(data){
                            $('#selectSolicitante').html(data);
                        }
                    });
                }

                function cargarProforma(codCli){
                    var url = "/sistema/cargarProforma/?idCliente="+codCli;
                    $.ajax({
                        type: "GET",
                        url: url,
                        success: function(data){
                            $('#selectProforma').html(data);
                        }
                    });
                }

                function cargarFactura(codCli){
                    var url = "/sistema/cargarFactura/?idCliente="+codCli;
                    $.ajax({
                        type: "GET",
                        url: url,
                        success: function(data){
                            $('#selectFactura').html(data);
                        }
                    });
                }

                function openFacturar(){
                    if (obtenerRowChecked() == ""){
                        alert("Debe seleccionar Viajes para poder facturar.")
                    }else{
                        $('#numeroFactura').val("");
                        $('#facturarClientesModal').modal('toggle');
                    }
                }

                function guardarNumeroFactura(){
                    if ($('#primernumeroFactura').val() == ""){
                        alert("El primer numero de factura no puede estar vacio.")
                        return false;
                    }
                    if ($('#numeroFactura').val() == ""){
                        alert("El numero de factura no puede estar vacio.")
                        return false;
                    }

                    var url = "/sistema/facturarClientes/";
                    $.ajax({
                        type: "POST",
                        url: url,
                        headers: {'X-CSRFToken': '{{ csrf_token }}'},
                        data: $("#facturarClientes").serialize(),
                        success: function(data){
                            alert("Viajes Facturados.")
                            $("#idViajes").val("");
                            $('#facturarClientesModal').modal('toggle');
                            //resetFiltros();
                            buscarFacturacion();
                        }
                    });
                }

                function obtenerRowChecked(){
                    var table = $('#tablaListadoFactClientes').DataTable();
                    var selectedRows = table.rows({ selected: true }).ids(true);
                    var ids = "";
                    for (var i = 0; i < selectedRows.length; i++) {
                        ids = ids + selectedRows[i].replace("#rowid","") + "-"
                    }
                    $("#idViajes").val(ids);
                    return ids;
                }

                function completarPrimerNumeroFactura(){
                    var size = $("#primernumeroFactura").val().length;
                    var poner = 4 - parseInt(size);
                    var i;
                    var texto = "";
                    for (i = 0; i < poner; i++) { 
                        texto += "0";
                    }
                    $("#primernumeroFactura").val(texto+$("#primernumeroFactura").val());
                }

                function completarNumeroFactura(){
                    var size = $("#numeroFactura").val().length;
                    var poner = 8 - parseInt(size);
                    var i;
                    var texto = "";
                    for (i = 0; i < poner; i++) { 
                        texto += "0";
                    }
                    $("#numeroFactura").val(texto+$("#numeroFactura").val());
                }

                function asignarProforma(){
                    if (obtenerRowChecked() == ""){
                        alert("Debe seleccionar Viajes para poder facturar.");
                        return false;
                    }else{
                        var url = "/sistema/proformarClientes/";
                        $.ajax({
                            type: "POST",
                            url: url,
                            headers: {'X-CSRFToken': '{{ csrf_token }}'},
                            data: $("#facturarClientes").serialize(),
                            success: function(data){
                                alert(data.return);
                                $("#idViajes").val("");
                                buscarFacturacion();
                            }
                        });
                    }
                }

                function exportarPdf( e, dt, node, config ){
                    var table = $('#tablaListadoFactClientes').DataTable();
                    var selectedRows = table.rows().ids(true);
                    var ids = "";
                    for (var i = 0; i < selectedRows.length; i++) {
                        ids = ids + selectedRows[i].replace("#rowid","") + "-"
                    }

                    var params = '<input type="hidden" name="cliente" value="'+$("#cliente").val()+'">';
                    params += '<input type="hidden" name="desde" value="'+$("#desde").val()+'">';
                    params += '<input type="hidden" name="hasta" value="'+$("#hasta").val()+'">';
                    params += '<input type="hidden" name="ids" value="'+ids+'">';
                    params += '<input type="hidden" name="centrosCosto" value="'+$("#centroDeCosto").val()+'">';

                    $("#formularioPdf").html('');
                    $("#formularioPdf").html('<form id="dynForm" target="_blank" action="/sistema/exportarPdfFactCliente/" method="get">'+params+'</form>');
                    $("#dynForm").submit();
                }

                function exportarExcel( e, dt, node, config ){
                    var ids = "ids=1,2,3"
                    var url = "/sistema/exportarExcelFactCliente/";
                    $.ajax({
                        type: "POST",
                        url: url,
                        headers: {'X-CSRFToken': '{{ csrf_token }}'},
                        data: ids,
                        success: function(data){
                            console.log(data)
                            window.location.href = data
                        }
                    });
                }

            </script>

        </div>
    </body>

</html>