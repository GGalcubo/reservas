{% load static %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    {% include "sistema/cabecera.html" %}
    <body id="datosCliente" class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-reversed page-sidebar-fixed page-md">
        {% include "sistema/barra_top.html" %}
        <div class="page-container">
            {% include "sistema/barra_lat.html" %}
            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <i class="icon-directions"></i>
                                <a href="/sistema/operaciones/">Operaciones</a>
                                <i class="fa fa-angle-right"></i>
                            </li>
                            <li>
                                <a href="/sistema/listadoUnidad/">Listado de Unidades</a>
                                <i class="fa fa-angle-right"></i>
                            </li>
                            <li>
                                <span>Unidad</span>
                            </li>
                        </ul>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                            <div class="portlet light ">
                                <div class="portlet-title">
                                    <div class="caption font-blue">
                                        <i class="icon-star font-blue"></i>
                                        <span class="caption-subject bold uppercase">Alta/Edición de Unidad</span>
                                    </div>
                                    <div class="tools"> </div>
                                </div>
                                <div class="portlet-body">
                                    <form role="form" method="post" id="formGuardarUnidad" action="/sistema/guardarUnidad/">{% csrf_token %}
                                        <input type="hidden" id="idUnidad" name="idUnidad" value="{{ unidad.id }}">
                                        <input type="hidden" id="idChofer" name="idChofer" value="{{ unidad.getIdChofer }}">
                                        <input type="hidden" id="idOwner" name="idOwner" value="{{ unidad.getIdOwner }}">
                                        <input type="hidden" id="idVehiculo" name="idVehiculo" value="{{ unidad.getIdVehiculo }}">
                                        <input type="hidden" id="idLicencia" name="idLicencia" value="0">
                                        <div class="form-body">
                                            <div class="row">
                                                <div class="col-sm-1">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="selectIdFake" name="selectIdFake">
                                                            {% for i in ids_fake %}
                                                                <option value="{{ i }}" >{{ i }}</option>
                                                            {% endfor %}
                                                        </select>
                                                        <label for="selectIdFake">Ids</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="identificacion" name="identificacion" value="{{ unidad.identificacion }}">
                                                        <label for="identificacion">Nombre de la unidad</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-checkboxes">
                                                        <div class="md-checkbox-inline">
                                                            <div class="md-checkbox">
                                                                <input type="hidden" id="unidadPropiaValue" class="md-check" name="unidadPropiaValue" value="{{ unidad.unidad_propia }}">
                                                                <input type="checkbox" id="unidadPropia" class="md-check" name="unidadPropia">
                                                                <label for="unidadPropia">
                                                                    <span></span>
                                                                    <span class="check"></span>
                                                                    <span class="box"></span> Unidad propia </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-5">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="selectOwners" name="selectOwners">
                                                            <option value="">Seleccionar dueño</option>
                                                            {% for o in owners %}
                                                                <option value="{{ o.id }}" >{{ o.apellido }} {{ o.nombre }}</option>
                                                            {% endfor %}
                                                        </select>
                                                        <label for="selectOwners">Dueño</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-2 text-center">
                                                    <div class="form-group form-md-line-input">
                                                        <a href="#add_duenio" data-toggle="modal" role="button" class="btn btn-outline green">+ Dueño</a>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="number" min="0" max="100" class="form-control" onchange="balanceoOwnerFacturacion();" value="{{unidad.porcentaje_owner|default_if_none:""}}" id="porcFacturacionOwner" name="porcFacturacionOwner">
                                                        <label for="porcFacturacionOwner">% de Facturación</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-5">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="selectChoferes" name="selectChoferes">
                                                            <option value="">Seleccionar chofer</option>
                                                            {% for c in choferes %}
                                                                <option value="{{ c.id }}" >{{ c.apellido }} {{ c.nombre }}</option>
                                                            {% endfor %}
                                                        </select>
                                                        <label for="selectChoferes">Chofer</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-2 text-center">
                                                    <div class="form-group form-md-line-input">
                                                        <a href="#add_chofer" data-toggle="modal" role="button" class="btn btn-outline green">+ Chofer</a>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="number" min="0" max="100" class="form-control" onchange="balanceoChoferFacturacion();" value="{{unidad.porcentaje_chofer|default_if_none:""}}" id="porcFacturacionChofer" name="porcFacturacionChofer" placeholder=" ">
                                                        <label for="porcFacturacionChofer">% de Facturación</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="portlet-title">
                                                <div class="caption font-blue">
                                                    <i class="icon-star font-blue"></i>
                                                    <span class="caption-subject bold uppercase">Vehículo</span>
                                                </div>
                                                <div class="tools"> </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="patente" name="patente" value="{{ unidad.vehiculo.patente|default_if_none:"" }}">
                                                        <label for="patente">Patente</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="modelo" name="modelo" value="{{ unidad.vehiculo.modelo|default_if_none:"" }}">
                                                        <label for="modelo">Modelo</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="marca" name="marca" value="{{ unidad.vehiculo.marca|default_if_none:"" }}">
                                                        <label for="marca">Marca</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="color" name="color" value="{{ unidad.vehiculo.color|default_if_none:"" }}">
                                                        <label for="color">Color</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="year" name="year" value="{{ unidad.vehiculo.ano|default_if_none:"" }}">
                                                        <label for="year">Año</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="puertas" name="puertas" value="{{ unidad.vehiculo.puertas|default_if_none:"" }}">
                                                        <label for="puertas">Puertas</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="nro_motor" name="nro_motor" value="{{ unidad.vehiculo.nro_motor|default_if_none:"" }}">
                                                        <label for="nro_motor">Nro. Motor</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input form-md-floating-label">
                                                        <input type="text" class="form-control" id="nro_chasis" name="nro_chasis" value="{{ unidad.vehiculo.nro_chasis|default_if_none:"" }}">
                                                        <label for="nro_chasis">Nro. Chasis</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="add_duenio" class="modal fade" tabindex="-1" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                                            <h4 class="modal-title" style="color:#888;">Agregar Dueño</h4>
                                                        </div>
                                                        <form role="form" id="form-datos-unidad-owner" class="form-owner-unidad">
                                                        <div class="modal-body">
                                                            <div class="scroller" style="height:220px" data-always-visible="1" data-rail-visible1="1">
                                                                <div class="row">
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="nombreDuenio" name="nombreDuenio">
                                                                            <label for="nombreDuenio">Nombre</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="email" class="form-control" id="apellidoDuenio" name="apellidoDuenio">
                                                                            <label for="apellidoDuenio">Apellido</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="telefonoDuenio" name="telefonoDuenio">
                                                                            <label for="telfonoDuenio">Teléfono</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="dniDuenio" name="dniDuenio">
                                                                            <label for="dniDuenio">DNI</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="mailDuenio" name="mailDuenio">
                                                                            <label for="mailDuenio">Mail</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="domDuenio" name="domDuenio">
                                                                            <label for="domDuenio">Domicilio</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="fecNacDuenio" name="fecNacDuenio">
                                                                            <label for="fecNacDuenio">Fecha Nacimiento</label>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer noborder flex">
                                                          <button type="button" onclick="agregarOwner()" class="btn green">Guardar</button>
                                                          <button type="button" class="btn red" data-dismiss="modal">Cancelar</button>
                                                        </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="add_chofer" class="modal fade" tabindex="-1" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                                            <h4 class="modal-title" style="color:#888;">Agregar Chofer</h4>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="scroller" style="height:220px" data-always-visible="1" data-rail-visible1="1">
                                                                <div class="row">
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="nombreChofer" name="nombreChofer">
                                                                            <label for="nombreChofer">Nombre</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="email" class="form-control" id="apellidoChofer" name="apellidoChofer">
                                                                            <label for="apellidoChofer">Apellido</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="telefonoChofer" name="telefonoChofer">
                                                                            <label for="telefonoChofer">Teléfono</label>
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="dniChofer" name="dniChofer">
                                                                            <label for="dniChofer">DNI</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="mailChofer" name="mailChofer">
                                                                            <label for="mailChofer">Mail</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="domChofer" name="domChofer">
                                                                            <label for="domChofer">Domicilio</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="fecNacChofer" name="fecNacChofer">
                                                                            <label for="fecNacChofer">Fecha Nacimiento</label>
                                                                        </div>
                                                                    </div>


                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer noborder flex flex-j-between">
                                                          <button type="button" onclick="agregarChofer()" class="btn green">Guardar</button>
                                                          <button type="button" class="btn red" data-dismiss="modal">Cancelar</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="add_licencia" class="modal fade" tabindex="-1" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                                            <h4 class="modal-title" style="color:#888;">Agregar Licencia</h4>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="scroller" style="height:120px" data-always-visible="1" data-rail-visible1="1">
                                                                <div class="row">
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input">
                                                                            <select id="personaLicencia" class="form-control" name="personaLicencia">
                                                                            </select>
                                                                            <label for="personas">Asignar licencia a:</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input">
                                                                            <select class="form-control" id="tipoLicencia" name="tipoLicencia">
                                                                                {% for tl in tipo_licencias %}
                                                                                <option value="{{ tl.id }}">{{ tl.tipo_licencia }}</option>
                                                                                {% endfor %}
                                                                            </select>
                                                                            <label for="tipoLicencia">Tipo de Licencia</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-sm-6">
                                                                        <label for="vencimientoLicencia">Vencimiento</label>
                                                                        <input class="form-control" id="vencimientoLicencia" name="vencimientoLicencia" size="12" type="text" />
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        <div class="form-group form-md-line-input form-md-floating-label">
                                                                            <input type="text" class="form-control" id="descripcionLicencia" name="descripcionLicencia" placeholder="">
                                                                            <label for="descripcionLicencia">Descripción</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer noborder flex">
                                                          <button type="button" onclick="agregarLicencia()" class="btn green">Guardar</button>
                                                          <button type="button" class="btn red" onclick="cerrarModalLicencia();" >Cancelar</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-actions noborder flex mg-t-20">
                                            <button type="button" onclick="guardarUnidad();" class="btn green btn-outline mg-r-10">Guardar</button>
                                            <button type="button" class="btn btn-outline red">Cancelar</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- END EXAMPLE TABLE PORTLET-->
                        </div>
                        <div class="col-sm-12" id="unidadDetalle" >
                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                            <div class="portlet light ">
                                <div class="portlet-body">
                                    <div class="tabbable-line">
                                        <ul class="nav nav-tabs ">
                                            <li class="active">
                                                <a href="#tabLicenciasUnidad" data-toggle="tab" aria-expanded="true"> Licencias </a>
                                            </li>
                                            <li class="">
                                                <a href="#tabObservacionesUnidad" data-toggle="tab" aria-expanded="true"> Observaciones </a>
                                            </li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="tabLicenciasUnidad">
                                                <form role="form" class="form-licencias-unidad">
                                                    <div class="form-body">
                                                        <div class="row">
                                                            <div class="col-sm-12">
                                                                <!-- BEGIN EXAMPLE TABLE PORTLET-->
                                                                <div class="portlet light ">
                                                                    <div class="portlet-title">
                                                                        <div class="caption font-blue">
                                                                            <i class="icon-lock font-blue mg-t-8"></i>
                                                                            <span class="caption-subject bold uppercase">Licencias</span>
                                                                            <a href="#add_licencia" data-toggle="modal" role="button" class="btn green btn-outline mg-l-20">Agregar licencia</a>
                                                                        </div>
                                                                        <div class="tools"> </div>
                                                                    </div>
                                                                    <div class="portlet-body">
                                                                        <div id="grillaLicencias" >
                                                                            <table class="table table-striped table-bordered table-hover dt-responsive" width="100%" id="tablaLicenciasUnidad">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th class="all" style="min-width: 120px;">Acciones</th>
                                                                                        <!-- <th class="all">Eliminar</th> -->
                                                                                        <th class="all">Asignada</th>
                                                                                        <th class="all">Licencia</th>
                                                                                        <th class="all">Vencimiento</th>
                                                                                        <th class="all">Comentario</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                    {% for l in unidad.getLicencias %}
                                                                                    <tr>
                                                                                        <td class="text-center">
                                                                                            <a href="#" onclick="editarLicenciaPropect('{{ l.id }}','{{ unidad.id }}','{{ l.getAsignadoTipo }}','{{ l.tipo_licencia.id }}','{{ l.getFechaVencimiento }}','{{ l.comentario }}');" class="btn btn-xs btn-outline blue"><i class="fa fa-pencil"></i></a>
                                                                                            <a href="#" onclick="eliminarLicenciaPropect('{{ l.id }}','{{ unidad.id }}');" class="btn btn-xs btn-outline red"><i class="fa fa-times"></i></a>
                                                                                        </td>
                                                                                        <td class="text-center">{{ l.getAsignadoNombre }} ({{ l.getAsignadoTipo }})</td>
                                                                                        <td>{{ l.tipo_licencia.tipo_licencia }}</td>
                                                                                        <td>{{ l.getFechaVencimiento }}</td>
                                                                                        <td>{{ l.comentario }}</td>
                                                                                    </tr>
                                                                                    {% endfor %}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- END EXAMPLE TABLE PORTLET-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-actions noborder flex">
                                                        <button type="button" class="btn green btn-outline mg-r-10">Guardar</button>
                                                        <button type="button" class="btn btn-outline red">Cancelar</button>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="tab-pane" id="tabObservacionesUnidad">
                                                <form role="form" id="form-datos-unidad-observacion" class="form-observacion-unidad">{% csrf_token %}
                                                    <div class="form-body">
                                                        <div class="row">
                                                            <div class="col-sm-12">
                                                                <!-- BEGIN EXAMPLE TABLE PORTLET-->
                                                                <div class="portlet light ">
                                                                    <div class="portlet-title">
                                                                        <div class="caption font-blue">
                                                                            <i class="icon-notebook font-blue mg-t-8"></i>
                                                                            <span class="caption-subject bold uppercase">Observaciones</span>
                                                                            <a href="#add_observacion_unidad" role="button" data-toggle="modal" class="btn green btn-outline mg-l-20">Agregar observación</a>
                                                                        </div>
                                                                        <div class="tools"> </div>
                                                                    </div>
                                                                    <div class="portlet-body">
                                                                        <div id="grillaObservaciones" >
                                                                            <table class="table table-striped table-bordered table-hover dt-responsive" width="100%" id="tablaObservacionUnidades">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th class="all">Fecha</th>
                                                                                        <th class="all">Usuario</th>
                                                                                        <th class="all">Observación</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                    {% for o in unidad.getObservaciones %}
                                                                                    <tr>
                                                                                        <td>{{ o.getFechaHora }}</td>
                                                                                        <td>{{ o.usuario }}</td>
                                                                                        <td>{{ o.texto }}</td>
                                                                                    </tr>
                                                                                    {% endfor %}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-md-12">
                                                                                <input type="hidden" id="idUnidadObser" name="idUnidadObser" value="{{ unidad.id }}">
                                                                                <div id="add_observacion_unidad" class="modal fade" tabindex="-1" aria-hidden="true">
                                                                                    <div class="modal-dialog">
                                                                                        <div class="modal-content">
                                                                                            <div class="modal-header">
                                                                                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                                                                                <h4 class="modal-title" style="color:#888;">Agregar Observación</h4>
                                                                                            </div>
                                                                                            <div class="modal-body">
                                                                                                <div class="scroller" style="height:100px" data-always-visible="1" data-rail-visible1="1">
                                                                                                    <div class="row">
                                                                                                        <div class="col-sm-6 col-sm-offset-3">
                                                                                                            <div class="form-group form-md-line-input">
                                                                                                                <textarea class="form-control" id="textAreaObservacion" name="textAreaObservacion" rows="3" placeholder=""></textarea>
                                                                                                                <label for="form_control_1">Observaciones de la unidad</label>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="modal-footer noborder flex">
                                                                                              <button type="button" onclick="agregarObservacion()" class="btn green">Guardar</button>
                                                                                              <button type="button" class="btn red" data-dismiss="modal">Cancelar</button>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- END EXAMPLE TABLE PORTLET-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-actions noborder flex">
                                                        <button type="button" class="btn green btn-outline mg-r-10">Guardar</button>
                                                        <button type="button" class="btn btn-outline red">Cancelar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- END EXAMPLE TABLE PORTLET-->
                        </div>
                    </div>

                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
            <!-- BEGIN QUICK SIDEBAR -->
            <!-- END QUICK SIDEBAR -->
        </div>
        <!-- END CONTAINER -->
        {% include "sistema/footer.html" %}

            <!-- SCRIPTS PROPIOS DE ESTA VISTA -->
            <script>
                $(document).ready(function(){
                    $('#tablaLicenciasUnidad').DataTable( {
                        responsive: true,
                        // scrollY: 200,
                        order: [[ 4, "asc" ]],
                        lengthMenu: [
                                        [ 100, 50, 25, 10, -1 ],
                                        [ '100', '50', '25', '10', 'Todos' ]
                                    ],
                        language: {
                            url: '//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json'
                        },
                    } );

                    $('#tablaObservacionUnidades').DataTable( {
                        responsive: true,
                        // scrollY: 200,
                        order: [[ 0, "asc" ]],
                        lengthMenu: [
                                        [ 100, 50, 25, 10, -1 ],
                                        [ '100', '50', '25', '10', 'Todos' ]
                                    ],
                        language: {
                            url: '//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json'
                        },
                    } );

                    $('#vencimientoLicencia').datepicker({
                        language: 'es',
                        dateFormat: 'dd/mm/yy',
                        // todayBtn: true,
                        todayHighlight: true,
                        autoclose: true
                    });

                    $('#fecNacDuenio').datepicker({
                        language: 'es',
                        dateFormat: 'dd/mm/yy',
                        // todayBtn: true,
                        todayHighlight: true,
                        autoclose: true
                    });

                    $('#fecNacChofer').datepicker({
                        language: 'es',
                        dateFormat: 'dd/mm/yy',
                        // todayBtn: true,
                        todayHighlight: true,
                        autoclose: true
                    });

                    var idUnidad = $("#idUnidad").val()
                    if (idUnidad == "0"){
                        $("#unidadDetalle").hide()
                    }else{
                        $("#unidadDetalle").show()
                    }

                    $("#selectChoferes").val($("#idChofer").val())
                    $("#selectOwners").val($("#idOwner").val())

                    if ($("#idChofer").val() != ""){
                        $('#personaLicencia').append($("<option></option>").attr("value",'chofer').text('{{ unidad.chofer.nombre }}' + " " + '{{ unidad.chofer.apellido }}' + " (chofer)")); 
                    }
                    if ($("#idOwner").val() != ""){
                        $('#personaLicencia').append($("<option></option>").attr("value",'owner').text('{{ unidad.owner.nombre }}' + " " + '{{ unidad.owner.apellido }}' + " (dueño)")); 
                    }
                    if ($("#idVehiculo").val() != ""){
                        $('#personaLicencia').append($("<option></option>").attr("value",'vehiculo').text('{{ unidad.vehiculo.patente }}' + " (vehiculo)")); 
                    }

                    $("#selectOwners").select2({
                        placeholder: "Seleccionar dueño",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    $("#selectChoferes").select2({
                        placeholder: "Seleccionar chofer",
                        allowClear: true,
                        dropdownAutoWidth : true,
                        width: 'auto'
                    });

                    if ($("#unidadPropiaValue").val() == "True"){
                        $("#unidadPropia").prop( "checked", true );
                    }
                });

                function guardarUnidad(){
                    if ($("#selectIdFake").val() == null){
                        alert("El campo Id es obligatorio.");
                        return false;
                    }

                    if ($("#identificacion").val() == ""){
                        alert("El campo Nombre Unidad es obligatorio.");
                        return false;
                    }
                    if ($("#selectOwners").val() == ""){
                        alert("El campo Dueño es obligatorio");
                        return false;
                    }
                    
                    $("#formGuardarUnidad").submit();

                }

                function agregarObservacion(){
                    if ($('#textAreaObservacion').val() == ""){
                        alert("Campo observacion es obligatorio");
                    }else{
                        var url = "/sistema/guardarObservacionUnidad/";
                        $.ajax({
                            type: "POST",
                            url: url,
                            data: $("#form-datos-unidad-observacion").serialize(),
                            success: function(data){
                                $("#grillaObservaciones").html(data);
                                $('#textAreaObservacion').val("");
                            }
                        });
                        $('#add_observacion_unidad').modal('toggle');
                    }
                }

                function agregarLicencia(){
                    var url = "/sistema/guardarLicenciaUnidad/";
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: $("#formGuardarUnidad").serialize(),
                        success: function(data){
                            $("#grillaLicencias").html(data);
                            cerrarModalLicencia();
                        }
                    });
                }

                function agregarOwner(){
                    if ($('#nombreDuenio').val() == ""){
                        alert("Campo nombre es obligatorio.");
                    }else if ($('#apellidoDuenio').val() == ""){
                        alert("Campo apellido es obligatorio");
                    }else{
                        var url = "/sistema/guardarOwnerProspect/";
                        $.ajax({
                            type: "POST",
                            url: url,
                            data: $("#formGuardarUnidad").serialize(),
                            success: function(data){
                                $('#selectOwners').append($("<option></option>").attr("value",data.persona_id).text(data.persona_apellido + " " + data.persona_nombre)); 
                                $('#selectOwners').val(data.persona_id)
                            }
                        });
                        $('#add_duenio').modal('toggle');
                    }
                }

                function agregarChofer(){
                    if ($('#nombreChofer').val() == ""){
                        alert("Campo nombre es obligatorio.");
                    }else if ($('#apellidoChofer').val() == ""){
                        alert("Campo apellido es obligatorio");
                    }else{
                        var url = "/sistema/guardarChoferProspect/";
                        $.ajax({
                            type: "POST",
                            url: url,
                            data: $("#formGuardarUnidad").serialize(),
                            success: function(data){
                                $('#selectChoferes').append($("<option></option>").attr("value",data.persona_id).text(data.persona_apellido + " " + data.persona_nombre)); 
                                $('#selectChoferes').val(data.persona_id)
                                $('#porcFacturacionChofer').val(data.persona_porcentaje)
                                balanceoChoferFacturacion();
                            }
                        });
                        $('#add_chofer').modal('toggle');
                    }
                }

                function balanceoChoferFacturacion(){
                    var porcChofer = $('#porcFacturacionChofer').val();
                    if (porcChofer != ""){
                        if (porcChofer > 100){
                            porcChofer = 100;
                            $('#porcFacturacionChofer').val(100);
                        }
                        $('#porcFacturacionOwner').val(100 - porcChofer);
                    }else{
                        $('#porcFacturacionOwner').val(100);
                    }
                }

                function balanceoOwnerFacturacion(){
                    var porcOwner = $('#porcFacturacionOwner').val();
                    if (porcOwner != ""){
                        if (porcOwner > 100){
                            porcOwner = 100;
                            $('#porcFacturacionOwner').val(100);
                        }
                        $('#porcFacturacionChofer').val(100 - porcOwner);
                    }else{
                        $('#porcFacturacionChofer').val(100);
                    }
                }

                function cerrarModalLicencia(){
                    $('#idLicencia').val("0");
                    $('#vencimientoLicencia').val("");
                    $('#descripcionLicencia').val("");
                    $('#add_licencia').modal('toggle');
                }

                function editarLicenciaPropect(idLicencia, idUnidad, asignado, tipo, vencimiento, descripcion){
                    if (asignado == "Chofer"){
                        $('#personaLicencia').val("chofer");
                    }else if (asignado == "Vehiculo"){
                        $('#personaLicencia').val("vehiculo");
                    }else{
                        $('#personaLicencia').val("owner");
                    }
                    $('#idLicencia').val(idLicencia);
                    $('#tipoLicencia').val(tipo);
                    $('#vencimientoLicencia').val(vencimiento);
                    $('#descripcionLicencia').val(descripcion);
                    $('#add_licencia').modal('toggle');
                }    

                function eliminarLicenciaPropect(idLicencia, idUnidad){
                    var r = confirm("Desea eliminar la Licencia ??");
                    if (r == true) {
                        var url = "/sistema/eliminarLicenciaPropect/";
                        param = 'idLicencia='+idLicencia+'&idUnidad='+idUnidad;
                        $.ajax({
                            type: "POST",
                            url: url,
                            headers: {'X-CSRFToken': '{{ csrf_token }}'},
                            data: param,
                            success: function(data){
                                $("#grillaLicencias").html(data);
                            }
                        });
                    }
                    
                } 
                
            </script>

        </div>
    </body>

</html>