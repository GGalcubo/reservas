{% load static %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->

<link href="{% static 'css/select2.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'css/select2-bootstrap.min.css' %}" rel="stylesheet" type="text/css" />

<style>
    .tabbable-line > .tab-content {
            padding: 10px 0!important;
    }
    .disabled-select {
       background-color:#d5d5d5;
       opacity:0.5;
       border-radius:3px;
       cursor:not-allowed;
       position:absolute;
       top:0;
       bottom:0;
       right:0;
       left:0;
    }
</style>
<html lang="en">
<!--<![endif]-->
{% include "sistema/cabecera.html" %}
<body id="viajes" class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-reversed page-sidebar-fixed page-md">
{% include "sistema/barra_top.html" %}
<!-- BEGIN HEADER & CONTENT DIVIDER -->
<div class="clearfix"></div>
<!-- END HEADER & CONTENT DIVIDER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
    {% include "sistema/barra_lat.html" %}
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <div class="page-content">
            <!-- BEGIN PAGE HEADER-->
            <!-- END PAGE HEADER-->
            <div class="row">
                <div class="col-md-12">
                    <!-- BEGIN EXAMPLE TABLE PORTLET-->

                    <div id="viajeValidacion" class="alert alert-danger">
                        <button class="close" data-close="alert"></button>
                        <div></div> <div id="mensajeValidacion" ></div>
                    </div>
                    <div class="portlet light ">
                        <div class="portlet-title">
                            <div class="caption font-green">
                                <i class="icon-rocket font-green"></i>
                                <span class="caption-subject bold uppercase" id="viaje_titulo">Ingreso del Cliente y Datos del Viaje</span>
                            </div>
                            <div class="tools"></div>
                        </div>
                        <div class="portlet-body">
                            <form role="form" class="form-viaje-viaje" id="form-viaje-viaje" method="post" action="/sistema/guardarViaje/">{% csrf_token %}
                                <div class="form-body">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <div class="form-group form-md-line-input">
                                                <select class="form-control select2me" id="id_cliente" name="id_cliente">
                                                    <option value=""></option>
                                                    {% for c in clientes %}
                                                        {% if c.id == viaje.cliente.id %}
                                                            <option selected="selected" value="{{ c.id }}">{{ c.id }}</option>
                                                        {% else %}
                                                            <option value="{{ c.id }}">{{ c.id }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>
                                                <label>ID Cliente</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group form-md-line-input">
                                                <select class="form-control select2me" id="razon_social">
                                                    <option value=""></option>
                                                    {% for c in clientes %}
                                                        {% if c.id == viaje.cliente.id %}
                                                            <option selected="selected" value="{{ c.id }}">{{ c.razon_social }}</option>
                                                        {% else %}
                                                            <option value="{{ c.id }}">{{ c.razon_social }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>
                                                <label>Razón Social</label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group form-md-line-input">
                                                <input type="text" class="form-control" id="cliente_tel" value="" readonly>
                                                <label>Teléfono</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group form-md-line-input">
                                                <input type="text" class="form-control" id="cliente_direccion" value="" readonly>
                                                <label>Dirección</label>
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="form-group form-md-line-input">
                                                <input type="text" class="form-control" id="cliente_factura" value="" name="cliente_factura" readonly>
                                                <label>C. Fact.</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-7">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control" id="contacto" name="contacto"></select>
                                                        <label>Solicitante</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control" id="centro_costos" name="centro_costos">
                                                        </select>
                                                        <label>Centro de Costos</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control" id="pasajero" name="pasajero"></select>
                                                        <label>Pasajero</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control" id="fecha" value="{{ viaje.fecha }}" name="fecha">
                                                        <label>Fecha</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control" id="hora" value="{{ viaje.hora|default_if_none:"" }}" name="hora">
                                                        <label>Hora</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group form-md-line-input">
                                                        <input type="text" class="form-control" id="hora_estimada" value="{{ viaje.hora_estimada|default_if_none:"" }}" name="hora_estimada">
                                                        <label>H. E.</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control" id="categoria_viaje" name="categoria_viaje">
                                                            <option value=""></option>
                                                            {% for cv in categoria_viajes %}
                                                                {% if cv.id == viaje.categoria_viaje.id %}
                                                                    <option selected="selected" value="{{ cv.id }}">{{ cv.categoria }}</option>
                                                                {% else %}
                                                                    <option value="{{ cv.id }}">{{ cv.categoria }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label>C. Viaje</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" name="estado" id="estado">
                                                            {% for e in estados %}
                                                                {% if e.id == viaje.estado.id %}
                                                                    <option selected="selected" value="{{ e.id }}">{{ e.estado }}</option>
                                                                {% else %}
                                                                    <option value="{{ e.id }}">{{ e.estado }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label>Estado</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group form-md-line-input">
                                                        <div class="input-group left-addon right-addon">
                                                            <span class="input-group-addon">$</span>
                                                            <input type="text" class="form-control" id="costo_proveedor" name="costo_proveedor" value="{{ viaje.costo_proveedor }}">
                                                            <label for="form_control_1">Costo Proveedor</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group form-md-line-input">
                                                        <div class="input-group left-addon right-addon">
                                                            <span class="input-group-addon">$</span>
                                                            <input type="text" class="form-control"  id="tarifa_pasada" name="tarifa_pasada" >
                                                            <label for="form_control_1">Tarifa pasada</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="unidad_id" name="unidad_id">
                                                            <option value=""></option>
                                                            {% for u in unidades %}
                                                                {% if u.id == viaje.unidad.id %}
                                                                    <option selected="selected" value="{{ u.id }}">{{ u.id }}</option>
                                                                {% else %}
                                                                    <option value="{{ u.id }}">{{ u.id }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label>ID Unidad</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="unidad_identificacion">
                                                            <option value=""></option>
                                                            {% for u in unidades %}
                                                                {% if u.id == viaje.unidad.id %}
                                                                    <option selected="selected" value="{{ u.id }}">{{ u.identificacion }}</option>
                                                                {% else %}
                                                                    <option value="{{ u.id }}">{{ u.identificacion }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label>Unidad</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group form-md-line-input">
                                                        <textarea class="form-control" rows="3" placeholder="{{ viaje.comentario }}" name="comentario_chofer" id="comentario_chofer"></textarea>
                                                        <label>Comentario para el chofer</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-2">
                                            <div class="form-group form-md-line-input">
                                                <input type="text" class="form-control" id="espera" value="{{ viaje.espera }}" name="espera">
                                                <label>Espera</label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group form-md-line-input">
                                                <div class="input-group left-addon right-addon">
                                                    <span class="input-group-addon">$</span>
                                                    <input type="text" class="form-control" id="peaje" value="{{ viaje.peaje_total }}" name="peaje">
                                                    <label for="form_control_1">Peajes</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group form-md-line-input">
                                                <div class="input-group left-addon right-addon">
                                                    <span class="input-group-addon">$</span>
                                                    <input type="text" class="form-control" id="estacionamiento" value="{{ viaje.estacionamiento_total }}" name="estacionamiento">
                                                    <label for="form_control_1">Estacionamiento</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group form-md-line-input">
                                                <div class="input-group left-addon right-addon">
                                                    <span class="input-group-addon">$</span>
                                                    <input type="text" class="form-control" id="otros" value="{{ viaje.Otros_tot }}" name="otros">
                                                    <label for="form_control_1">Otros</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group form-md-checkboxes">
                                            <div class="md-checkbox-inline">
                                                <div class="md-checkbox">
                                                    <input type="checkbox" id="maletas" class="md-check" name="maletas">
                                                    <label for="maletas">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span> Maletas </label>
                                                </div>
                                                <div class="md-checkbox">
                                                    <input type="checkbox" id="bilingue" class="md-check" name="bilingue">
                                                    <label for="bilingue">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span> Bilingue </label>
                                                </div>
                                            </div>
                                        </div>
                                        </div>
                                        <div class="col-md-2">
                                            <span class="input-group-btn btn">
                                                <button class="btn green-haze" type="submit">Guardar</button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- END EXAMPLE TABLE PORTLET-->
                </div>
                <div class="col-md-12">
                    <!-- BEGIN EXAMPLE TABLE PORTLET-->
                    <div class="portlet light" id="viaje-tab">
                        <div class="portlet-body">
                            <div class="tabbable-line">
                                <ul class="nav nav-tabs ">
                                    <li class="active">
                                        <a href="#tab_15_1" data-toggle="tab" aria-expanded="true"> Viaje </a>
                                    </li>
                                    <li class="">
                                        <a href="#tab_15_2" data-toggle="tab" aria-expanded="false"> Observaciones</a>
                                    </li>
                                    <li class="">
                                        <a href="#tab_15_3" data-toggle="tab" aria-expanded="false"> Administración </a>
                                    </li>
                                    <li class="">
                                        <a href="#tab_15_4" data-toggle="tab" aria-expanded="false"> Historial </a>
                                    </li>
                                    <li class="">
                                        <a href="#tab_15_5" data-toggle="tab" aria-expanded="false"> Pasajeros </a>
                                    </li>
                                    <li class="">
                                        <a href="#tab_15_6" data-toggle="tab" aria-expanded="false"> Adjuntos </a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="tab_15_1">
                                        <form role="form" class="form-viaje-trayecto" id="form-viaje-trayecto" method="post">{% csrf_token %}
                                            <input type="hidden" id="trayecto_principal" name="trayecto_principal" value="1">
                                            <div class="form-body">
                                                <div class="row" style="margin-top: 50px;">
                                                    <div class="col-md-6">
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="caption font-green" style="margin:0 auto;margin-bottom: 30px;text-align: center">
                                                                    <span class="caption-subject bold uppercase" style="font-size: 16px">Desde</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <select class="form-control" id="desde_destino" name="desde_destino">
                                                                        <option value=""></option>
                                                                        {% for p in provincias %}
                                                                            {% if p.id == viaje.getTrayectoPrincipal.provincia_desde_id %}
                                                                                <option selected="selected" value="{{ p.id }}">{{ p.nombre }}</option>
                                                                            {% else %}
                                                                                <option value="{{ p.id }}">{{ p.nombre }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>
                                                                    <label>Destino</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <select class="form-control" id="desde_localidad" name="desde_localidad">
                                                                        <option value=""></option>
                                                                        {% for l in localidades %}
                                                                            {% if l.id == viaje.getTrayectoPrincipal.localidad_desde_id %}
                                                                                <option selected="selected" value="{{ l.id }}">{{ l.nombre }}</option>
                                                                            {% else %}
                                                                                <option value="{{ l.id }}">{{ l.nombre }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>
                                                                    <label>Localidad</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_calle" name="desde_calle" value="{{ viaje.getTrayectoPrincipal.calle_desde }}">
                                                                    <label>Calle</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_altura" name="desde_altura" value="{{ viaje.getTrayectoPrincipal.altura_desde }}">
                                                                    <label>Altura</label>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="desde_entre" name="desde_entre" value="{{ viaje.getTrayectoPrincipal.entre_desde }}">
                                                                    <label>Entre</label>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="caption font-green" style="margin:0 auto;margin-bottom: 30px;text-align: center">
                                                                    <span class="caption-subject bold uppercase" style="font-size: 16px">Hasta</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <select class="form-control" id="hasta_destino" name="hasta_destino">
                                                                        <option value=""></option>
                                                                        {% for p in provincias %}
                                                                            {% if p.id == viaje.getTrayectoPrincipal.provincia_hasta_id %}
                                                                                <option selected="selected" value="{{ p.id }}">{{ p.nombre }}</option>
                                                                            {% else %}
                                                                                <option value="{{ p.id }}">{{ p.nombre }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>
                                                                    <label>Destino</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <select class="form-control" id="hasta_localidad" name="hasta_localidad">
                                                                        <option value=""></option>
                                                                        {% for l in localidades %}
                                                                            {% if l.id == viaje.getTrayectoPrincipal.localidad_hasta_id %}
                                                                                <option selected="selected" value="{{ l.id }}">{{ l.nombre }}</option>
                                                                            {% else %}
                                                                                <option value="{{ l.id }}">{{ l.nombre }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>
                                                                    <label>Localidad</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_calle" name="hasta_calle" value="{{ viaje.getTrayectoPrincipal.calle_hasta }}">
                                                                    <label>Calle</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_altura" name="hasta_altura" value="{{ viaje.getTrayectoPrincipal.altura_hasta }}">
                                                                    <label>Altura</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group form-md-line-input">
                                                                    <input type="text" class="form-control" id="hasta_entre" name="hasta_entre" value="{{ viaje.getTrayectoPrincipal.entre_hasta }}">
                                                                    <label>Entre</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="row" style="margin-bottom: 30px">
                                                        <div class="col-md-12">
                                                            <span class="input-group-btn btn">
                                                                <button class="btn green-haze" type="submit">Guardar Tramo Principal</button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <form role="form">{% csrf_token %}
                                                            <div class="form-body">
                                                                <div class="row">
                                                                    <div class="col-sm-12">
                                                                        <!-- BEGIN EXAMPLE TABLE PORTLET-->
                                                                        <div class="portlet light ">
                                                                            <div class="portlet-title">
                                                                                <div class="caption font-blue">
                                                                                    <i class="icon-notebook font-blue mg-t-8"></i>
                                                                                    <span class="caption-subject bold uppercase">Tramos</span>
                                                                                    <a href="#add_tramo" role="button" data-toggle="modal" class="btn green btn-outline mg-l-20" id="add_button">Agregar tramo</a>
                                                                                </div>
                                                                                <div class="tools"> </div>
                                                                            </div>
                                                                            <div class="portlet-body">
                                                                                <div id="grillaTramos" >
                                                                                    {% include "sistema/grillaTramos.html" %}
                                                                                </div>
                                                                                <div class="row">
                                                                                    <div class="col-md-12">

                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- END EXAMPLE TABLE PORTLET-->
                                                                    </div>
                                                                </div>
                                                            </div>
{#                                                            <div class="form-actions noborder flex flex-j-between">#}
{#                                                                <button type="button" class="btn green">Guardar</button>#}
{#                                                                <button type="button" class="btn red">Cancelar</button>#}
{#                                                            </div>#}
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="tab-pane" id="tab_15_2">
                                        <form role="form" class="form-viaje-observacion">
                                            <div class="form-body">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="form-group form-md-line-input">
                                                            <select class="form-control" id="">
                                                                <option value=""></option>
                                                                <option value="1" selected="selected">Terminales -IN</option>
                                                                <option value="2">Terminales -OUT</option>
                                                                <option value="3">Dispo</option>
                                                                <option value="4">Viaje con espera</option>
                                                                <option value="4">Viaje no tarifado</option>
                                                            </select>
                                                            <label>Tipo de viaje</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group form-md-line-input">
                                                            <select class="form-control" id="">
                                                                <option value=""></option>
                                                                <option value="1" selected="selected">Aterrizó</option>
                                                                <option value="2">Contactó</option>
                                                                <option value="3">Salió</option>
                                                                <option value="4">Otro</option>
                                                            </select>
                                                            <label>Detalle</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group form-md-line-input">
                                                            <input type="text" class="form-control" id="" value="23:30">
                                                            <label>Hora</label>

                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-group form-md-line-input">
                                                            <textarea class="form-control" rows="3"
                                                                      placeholder=""></textarea>
                                                            <label>Comentario</label>

                                                        </div>
                                                        <div class="form-group form-md-line-input">
                                                            <button type="button" class="btn blue">Agregar Observación</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <div class="caption font-green" style="margin:0 auto;margin-bottom: 30px;text-align: center">
                                            <span class="caption-subject bold uppercase" style="font-size: 16px">Observaciones</span>
                                        </div>
                                        <table class="table table-striped table-bordered table-hover dt-responsive" width="100%" id="tablaClientes">
                                            <thead>
                                                <tr>
                                                    <th class="all">Editar</th>
                                                    <th class="min-tablet">Tipo</th>
                                                    <th class="min-phone-l">Detalle</th>
                                                    <th class="desktop">Hora</th>
                                                    <th class="min-tablet">Comentario</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="text-center"><a href=""><i class="fa fa-pencil"></i></a></td>
                                                    <td>Dispo</td>
                                                    <td>Llegó</td>
                                                    <td>12:00 hs</td>
                                                    <td>hubo demora por paro de docentes</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center"><a href=""><i class="fa fa-pencil"></i></a></td>
                                                    <td>Dispo</td>
                                                    <td>Llegó</td>
                                                    <td>12:00 hs</td>
                                                    <td>hubo demora por paro de docentes</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="tab-pane" id="tab_15_3">
                                        <p> Administración</p>
                                    </div>
                                    <div class="tab-pane" id="tab_15_4">
                                        <p> Historial</p>
                                        </p>
                                    </div>
                                    <div class="tab-pane" id="tab_15_5">
                                        <p> Pasajeros</p>
                                        </p>
                                    </div>
                                    <div class="tab-pane" id="tab_15_6">
                                        <p> Adjuntos</p>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END EXAMPLE TABLE PORTLET-->
                </div>
            </div>
        </div>
        <!-- END CONTENT BODY -->
    </div>
    <!-- END CONTENT -->
    <!-- BEGIN QUICK SIDEBAR -->
    <!-- END QUICK SIDEBAR -->
</div>
<!-- END CONTAINER -->


<!-- MODAL AGREGAR TRAMO -->

<div id="add_tramo" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title" style="color:#888;">Tramo</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="modal_id" value="modal_id">
                <div class="scroller" style="height:300px" data-always-visible="1" data-rail-visible1="1">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="caption font-green" style="margin:0 auto;margin-bottom: 30px;text-align: center">
                                        <span class="caption-subject bold uppercase" style="font-size: 16px">Desde</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <select class="form-control" id="modal_desde_destino" name="modal_desde_destino">
                                            {% for p in provincias %}
                                               <option value="{{ p.id }}">{{ p.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                        <label>Destino</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <select class="form-control" id="modal_desde_localidad" name="modal_desde_localidad">
                                            {% for l in localidades %}
                                               <option value="{{ l.id }}">{{ l.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                        <label>Localidad</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <input type="text" class="form-control" id="modal_desde_calle" value="modal_desde_calle">
                                        <label>Calle</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <input type="text" class="form-control" id="modal_desde_altura" value="modal_desde_altura">
                                        <label>Altura</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <input type="text" class="form-control" id="modal_desde_entre" value="modal_desde_entre">
                                        <label>Entre</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="caption font-green" style="margin:0 auto;margin-bottom: 30px;text-align: center">
                                        <span class="caption-subject bold uppercase" style="font-size: 16px">Hasta</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <select class="form-control" id="modal_hasta_destino" name="modal_hasta_destino">
                                            {% for p in provincias %}
                                               <option value="{{ p.id }}">{{ p.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                        <label>Destino</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <select class="form-control" id="modal_hasta_localidad" name="modal_hasta_localidad">
                                            {% for l in localidades %}
                                               <option value="{{ l.id }}">{{ l.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                        <label>Localidad</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <input type="text" class="form-control" id="modal_hasta_calle" value="modal_hasta_calle">
                                        <label>Calle</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <input type="text" class="form-control" id="modal_hasta_altura" value="modal_hasta_altura">
                                        <label>Altura</label>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group form-md-line-input">
                                        <input type="text" class="form-control" id="modal_hasta_entre" value="modal_hasta_entre">
                                        <label>Entre</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn dark btn-outline">Cerrar</button>
                <button type="button" onclick="agregarTramo()" class="btn green">Guardar</button>
            </div>
        </div>
    </div>
</div>
<!-- END MODAL AGREGAR TRAMO -->


{% include "sistema/footer.html" %}
<!-- SCRIPTS PROPIOS DE ESTA VISTA -->
<script src="{% static 'js/select2.full.min.js' %}" type="text/javascript"></script>

<script>

    var clientes = [];
    {% for cliente in clientes %}
        var centro_costos = [{% for cc in cliente.centrocosto_set.all %}
        { "id" : "{{ cc.id }}",
           "nombre" : "{{ cc.nombre }}"
        },
        {% endfor %}
        ];
        var personascliente = [{% for personacliente in cliente.personacliente_set.all %}
        { "id" : "{{ personacliente.persona.id }}",
           "nombre" : "{{ personacliente.persona.nombre}}",
           "tipo_persona" : "{{ personacliente.persona.tipo_persona}}"
        },
        {% endfor %}
        ];

        var obj = {
            id : {{ cliente.id }},
            razon_social:'{{ cliente.razon_social }}',
            direccion:'{{ cliente.calle }} {{ cliente.altura }} {{ cliente.piso }} {{ cliente.depto }}',
            categoria_id:'{{ cliente.categoria.categoria }}',
            telefono:'{{ cliente.telefonoPrincipal }}',
            centro_costos: centro_costos,
            personascliente: personascliente};
        clientes.push(obj);
    {% endfor %}

    var unidades = [];
    {% for unidad in unidades %}
        var obj = {
            id : {{ unidad.id }},
            identificacion:'{{ unidad.identificacion }}'};
        unidades.push(obj);
    {% endfor %}

    var estados = [];
    {% for estado in estados %}
        var obj = {
            id : {{ estado.id }},
            identificacion:'{{ estado.estado }}'};
        estados.push(obj);
    {% endfor %}

    var provincias = [];
    {% for provincia in provincias %}
        var obj = {
            id : {{ provincia.id }},
            nombre:'{{ provincia.nombre }}'};
        provincias.push(obj);
    {% endfor %}

    var localidades = [];
    {% for localidad in localidades %}
        var obj = {
            id : {{ localidad.id }},
            provincia : '{{ localidad.provincia }}',
            nombre:'{{ localidad.nombre }}'};
        localidades.push(obj);
    {% endfor %}

    var categoria_viajes = [];
    {% for categoria_viaje in categoria_viajes %}
        var obj = {
            id : '{{ categoria_viaje.id }}',
            codigo : '{{ categoria_viaje.codigo }}',
            categoria:'{{ categoria_viaje.categoria }}'};
        categoria_viajes.push(obj);
    {% endfor %}

    var es_nuevo = '{{ es_nuevo }}';

    function mostrarMsgValidacion(msg){
        $("#mensajeValidacion").html(msg);
        $("#viajeValidacion").show();
        $('html, body').animate({
            scrollTop: $("#viajeValidacion").offset().top - 100
          }, 100);
        return false;
    }

    function updateFillsByCliente(name, evt){
        var option_selected = evt.params.data.id - 1;
        $('#id_cliente').select2('val',clientes[option_selected].id);
        $('#razon_social').select2('val',clientes[option_selected].id);
        $('#id_cliente').val(clientes[option_selected].id).trigger("change");
        $('#razon_social').val(clientes[option_selected].id).trigger("change");
        $('#cliente_direccion').val(clientes[option_selected].direccion);
        $('#cliente_categoria').val(clientes[option_selected].categoria_id);
        $('#cliente_tel').val(clientes[option_selected].telefono);

        $('#centro_costos').empty();
        $('#contacto').empty();
        $('#pasajero').empty();

        $.each(clientes[option_selected].centro_costos, function(i, value) {
          $('#centro_costos').append($('<option>').text(value.nombre).attr('value', value.id));
        });
        $.each(clientes[option_selected].personascliente, function(i, value) {
            if(value.tipo_persona == 'Contacto'){
                $('#contacto').append($('<option>').text(value.nombre).attr('value', value.id));
            }
        });
        $.each(clientes[option_selected].personascliente, function(i, value) {
            if(value.tipo_persona == 'Pasajero'){
                $('#pasajero').append($('<option>').text(value.nombre).attr('value', value.id));
            }
        });
    }

    function updateFillsByUnidad(name, evt){
        var option_selected = evt.params.data.id - 1;
        $('#unidad_id').select2('val',unidades[option_selected].id);
        $('#unidad_identificacion').select2('val',unidades[option_selected].id);
        $('#unidad_id').val(unidades[option_selected].id).trigger("change");
        $('#unidad_identificacion').val(unidades[option_selected].id).trigger("change");
    }

    function agregarTramo(){
        if ($("#modal_desde_destino").val() == ""){
            alert("El campo desde destino es obligatorio.");
            return false;
        }
        if ($("#modal_desde_localidad").val() == ""){
            alert("El campo desde localidad es obligatorio.");
            return false;
        }
        if ($("#modal_hasta_destino").val() == ""){
            alert("El campo hasta destino es obligatorio.");
            return false;
        }
        if ($("#modal_hasta_localidad").val() == ""){
            alert("El campo hasta localidad es obligatorio.");
            return false;
        }

        var obj               = {};
        obj.desde_localidad   = $("#modal_desde_localidad").val();
        obj.desde_provincia   = $("#modal_desde_destino").val();
        obj.desde_calle       = $("#modal_desde_calle").val();
        obj.desde_altura      = $("#modal_desde_altura").val();
        obj.desde_entre       = $("#modal_desde_entre").val();
        obj.hasta_localidad   = $("#modal_hasta_localidad").val();
        obj.hasta_provincia   = $("#modal_hasta_destino").val();
        obj.hasta_altura      = $("#modal_hasta_altura").val();
        obj.hasta_calle       = $("#modal_hasta_calle").val();
        obj.hasta_entre       = $("#modal_hasta_entre").val();
        obj.principal         = 0;
        obj.idViaje           = viaje;
        obj.id                = $("#modal_id").val();


        var url = "/sistema/guardarTrayecto/"; // the script where you handle the form input.
        $.ajax({
               type: "POST",
               url: url,
               headers: {'X-CSRFToken': '{{ csrf_token }}'},
               data: obj, // serializes the form's elements.
               success: function(data)
               {
                   if(data.error == '1'){
                       alert(data.msg);
                   }else{
                       $("#grillaTramos").html(data);
                       $('#add_tramo').modal('toggle');
                   }
               }
             });
    }

    $(document).ready(function () {
        if(es_nuevo == '1'){
            $("#viaje-tab").hide();
            $('#estado').attr("disabled", true);
        }else{
            viaje = {{ viaje.id }};
            $('#viaje_titulo').html('Ingreso del Cliente y Datos del Viaje ' + viaje);
            //HAGO ESTO PARA SIMULAR UN EVENTO QUE PIDE LA FUNCION DE SELECT2ME
            var evt = {};
            evt.params = {};
            evt.params.data = {};
            evt.params.data.id = '{{ viaje.cliente.id|default_if_none:"" }}';

            updateFillsByCliente('', evt);
        }

        $("#mensajeValidacion").html("");
        $("#viajeValidacion").hide();

        $("#id_cliente").on("select2:select", function (e) { updateFillsByCliente("select2:select", e); });
        $("#razon_social").on("select2:select", function (e) { updateFillsByCliente("select2:select", e); });
        $("#unidad_id").on("select2:select", function (e) { updateFillsByUnidad("select2:select", e); });
        $("#unidad_identificacion").on("select2:select", function (e) { updateFillsByUnidad("select2:select", e); });

        $("#form-viaje-viaje").submit(function(e) {
            if ($("#id_cliente").val() == ""){
                mostrarMsgValidacion("El campo id cliente es obligatorio.");
                return false;
            }
            if ($("#razon_social").val() == ""){
                mostrarMsgValidacion("El campo razon social es obligatorio.");
                return false;
            }
            if ($("#contacto").val() == ""){
                mostrarMsgValidacion("El campo contacto es obligatorio.");
                return false;
            }
            if ($("#centro_costos").val() == ""){
                mostrarMsgValidacion("El campo centro de costo es obligatorio.");
                return false;
            }
            if ($("#pasajero").val() == ""){
                mostrarMsgValidacion("El campo pasajero es obligatorio.");
                return false;
            }
            if ($("#fecha").val() == ""){
                mostrarMsgValidacion("El campo fecha es obligatorio.");
                return false;
            }
            if ($("#hora").val() == ""){
                mostrarMsgValidacion("El campo hora es obligatorio.");
                return false;
            }
            if ($("#hora_estimada").val() == ""){
                mostrarMsgValidacion("El campo hora estimada es obligatorio.");
                return false;
            }
            if ($("#categoria_viaje").val() == ""){
                mostrarMsgValidacion("El campo categoria viaje es obligatorio.");
                return false;
            }
            if ($("#unidad_id").val() == ""){
                mostrarMsgValidacion("El campo unidad id es obligatorio.");
                return false;
            }
            if ($("#unidad_identificacion").val() == ""){
                mostrarMsgValidacion("El campo unidad identificacion es obligatorio.");
                return false;
            }
            if ($("#estado").val() == ""){
                mostrarMsgValidacion("El campo estado es obligatorio.");
                return false;
            }

            var obj               = {};
            obj.estado            = $("#estado").val();
            obj.cliente           = $("#id_cliente").val();
            obj.contacto          = $("#contacto").val();
            obj.centro_costos     = $("#centro_costos").val();
            obj.pasajero          = $("#pasajero").val();
            obj.fecha             = $("#fecha").val();
            obj.hora              = $("#hora").val();
            obj.hora_estimada     = $("#hora_estimada").val();
            obj.costo_proveedor   = $("#costo_proveedor").val();
            obj.tarifa_pasada     = $("#tarifa_pasada").val();
            obj.comentario_chofer = $("#comentario_chofer").val();
            obj.unidad            = $("#unidad_id").val();
            obj.espera            = $("#espera").val();
            obj.peaje             = $("#peaje").val();
            obj.otros             = $("#otros").val();
            obj.estacionamiento   = $("#estacionamiento").val();
            obj.categoria_viaje   = $("#categoria_viaje").val();
            obj.maletas           = $("#maletas").val();
            obj.bilingue          = $("#bilingue").val();
            obj.es_nuevo          = es_nuevo;

            if(es_nuevo == 0){
                obj.idViaje = viaje;
            }

            var url = "/sistema/guardarViaje/"; // the script where you handle the form input.
            $.ajax({
                   type: "POST",
                   url: url,
                   headers: {'X-CSRFToken': '{{ csrf_token }}'},
                   data: obj, // serializes the form's elements.
                   success: function(data)
                   {
                       $("#viaje-tab").show();
                       $("#mensajeValidacion").html("");
                       $("#viajeValidacion").hide();
                       alert(data.msg); // show response from the php script.
                       viaje = data.id_viaje;
                       $('#viaje_titulo').html('Ingreso del Cliente y Datos del Viaje ' + viaje);
                   }
                 });

            e.preventDefault(); // avoid to execute the actual submit of the form.
        });

        $("#form-viaje-trayecto").submit(function(e) {
            if ($("#desde_destino").val() == ""){
                alert("El campo desde destino es obligatorio.");
                return false;
            }
            if ($("#desde_localidad").val() == ""){
                alert("El campo desde localidad es obligatorio.");
                return false;
            }
            if ($("#hasta_destino").val() == ""){
                alert("El campo hasta destino es obligatorio.");
                return false;
            }
            if ($("#hasta_localidad").val() == ""){
                alert("El campo hasta localidad es obligatorio.");
                return false;
            }

            var obj               = {};
            obj.desde_localidad   = $("#desde_localidad").val();
            obj.desde_provincia   = $("#desde_destino").val();
            obj.desde_calle       = $("#desde_calle").val();
            obj.desde_altura      = $("#desde_altura").val();
            obj.desde_entre       = $("#desde_entre").val();
            obj.hasta_localidad   = $("#hasta_localidad").val();
            obj.hasta_provincia   = $("#hasta_destino").val();
            obj.hasta_altura      = $("#hasta_altura").val();
            obj.hasta_calle       = $("#hasta_calle").val();
            obj.hasta_entre       = $("#hasta_entre").val();
            obj.principal         = 1;
            obj.idViaje           = viaje;


            var url = "/sistema/guardarTrayecto/"; // the script where you handle the form input.
            $.ajax({
                   type: "POST",
                   url: url,
                   headers: {'X-CSRFToken': '{{ csrf_token }}'},
                   data: obj, // serializes the form's elements.
                   success: function(data)
                   {
                       //$("#viaje-tab").show();
                       alert(data.msg); // show response from the php script.
                   }
                 });

            e.preventDefault(); // avoid to execute the actual submit of the form.
        });

        $(document).on( "click", '.delete_button',function(e) {

            var obj               = {};
            obj.id                = $(this).data('id');
            obj.idViaje           = viaje;

            var url = "/sistema/borrarTrayecto/"; // the script where you handle the form input.
            $.ajax({
                   type: "POST",
                   url: url,
                   headers: {'X-CSRFToken': '{{ csrf_token }}'},
                   data: obj, // serializes the form's elements.
                   success: function(data)
                   {
                       if(data.error == '1'){
                           alert(data.msg);
                       }else{
                           $("#grillaTramos").html(data);
                       }
                   }
                 });
        });

        $(document).on( "click", '#add_button',function(e) {
            $("#modal_id").val('0');

            $("#modal_desde_destino").val('');
            $("#modal_desde_localidad").val('');
            $("#modal_hasta_destino").val('');
            $("#modal_hasta_localidad").val('');

            $("#modal_desde_calle").val('');
            $("#modal_desde_altura").val('');
            $("#modal_desde_entre").val('');
            $("#modal_hasta_calle").val('');
            $("#modal_hasta_altura").val('');
            $("#modal_hasta_entre").val('');
        });

        $(document).on( "click", '.edit_button',function(e) {

            var id              = $(this).data('id');

            var provincia_desde = $(this).data('provincia_desde');
            var localidad_desde = $(this).data('localidad_desde');
            var provincia_hasta = $(this).data('provincia_hasta');
            var localidad_hasta = $(this).data('localidad_hasta');

            var calle_desde     = $(this).data('calle_desde');
            var altura_desde    = $(this).data('altura_desde');
            var entre_desde     = $(this).data('entre_desde');
            var calle_hasta     = $(this).data('calle_hasta');
            var altura_hasta    = $(this).data('altura_hasta');
            var entre_hasta     = $(this).data('entre_hasta');

            $("#modal_id").val(id);

            $("#modal_desde_destino").val(provincia_desde);
            $("#modal_desde_localidad").val(localidad_desde);
            $("#modal_hasta_destino").val(provincia_hasta);
            $("#modal_hasta_localidad").val(localidad_hasta);

            $("#modal_desde_calle").val(calle_desde);
            $("#modal_desde_altura").val(altura_desde);
            $("#modal_desde_entre").val(entre_desde);
            $("#modal_hasta_calle").val(calle_hasta);
            $("#modal_hasta_altura").val(altura_hasta);
            $("#modal_hasta_entre").val(entre_hasta);

            //$(".modal-title").text('Editar Tramo');
        });

        $('#tablaTramos').DataTable( {
            responsive: true,
            // scrollY: 200,
            order: [[ 0, "asc" ]],
            lengthMenu: [
                            [ -1, 500, 100, 50, 25, 10 ],
                            [ 'Todos', '500', '100', '50', '25', '10' ]
                        ],
            language: {
                url: '//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json'
            },
        } );
    });
</script>
</body>

</html>