{% load static %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="es">
    <!--<![endif]-->
    {% include "sistema/cabecera.html" %}
    <body id="clientes" class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-reversed page-sidebar-fixed page-md">
        {% include "sistema/barra_top.html" %}
        <div class="page-container">
            {% include "sistema/barra_lat.html" %}
            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <i class="icon-directions"></i>
                                <a href="/sistema/operaciones/">Operaciones</a>
                                <i class="fa fa-angle-right"></i>
                            </li>
                            <li>
                                <span>Tramo Tarifario</span>
                            </li>
                        </ul>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                            <div class="portlet light ">
                                <div class="portlet-title">
                                    <div class="caption font-blue">
                                        <i class="icon-list font-blue mg-t-8"></i>
                                        <span class="caption-subject bold uppercase">Tramo Tarifario</span>
                                    </div>
                                    <div class="tools"> </div>
                                </div>
                                <div class="portlet-body">
                                    <form role="form" class="form-datos-tarifario" method="post" id="formTramoTrayecto" action="/sistema/listadoTramoTarifario/">{% csrf_token %}
                                        <div class="form-body">
                                            <div class="row">

                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="provinciaDesde" name="provinciaDesde" style="width: 100%;" onchange="onchangeProvDesde()">
                                                            <option value="">Provincia Desde</option>
                                                            {% for p in provincias %}
                                                                {% if p.id == idDesdeProv %}
                                                                    <option selected value="{{ p.id }}" >{{ p.nombre }}</option>
                                                                {% else %}
                                                                    <option value="{{ p.id }}" >{{ p.nombre }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label for="provinciaDesde">Provincia Desde</label>
                                                    </div>
                                                </div>

                                                <div class="col-sm-3" id="localidadDesdeSelect">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="localidadDesde" name="localidadDesde" style="width: 100%;">
                                                            <option value="">Localidad Desde</option>
                                                            {% for loc in localidadesDesde %}
                                                                {% if loc.id == idDesdeLoc %}
                                                                    <option selected value="{{ loc.id }}" >{{ loc.nombre }}</option>
                                                                {% else %}
                                                                    <option value="{{ loc.id }}" >{{ loc.nombre }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label for="localidadDesde">Localidad Desde</label>
                                                    </div>
                                                </div>

                                                <div class="col-sm-3">
                                                    <div class="form-group form-md-line-input" onchange="onchangeProvHasta()">
                                                        <select class="form-control select2me" id="provinciaHasta" name="provinciaHasta" style="width: 100%;">
                                                            <option value="">Provincia Hasta</option>
                                                            {% for p in provincias %}
                                                                {% if p.id == idHastaProv %}
                                                                    <option selected value="{{ p.id }}" >{{ p.nombre }}</option>
                                                                {% else %}
                                                                    <option value="{{ p.id }}" >{{ p.nombre }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label for="provinciaHasta">Provincia Hasta</label>
                                                    </div>
                                                </div> 

                                                <div class="col-sm-3" id="localidadHastaSelect">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control select2me" id="localidadHasta" name="localidadHasta" style="width: 100%;">
                                                            <option value="">Seleccionar Hasta</option>
                                                            {% for loc in localidadesHasta %}
                                                                {% if loc.id == idHastaLoc %}
                                                                    <option selected value="{{ loc.id }}" >{{ loc.nombre }}</option>
                                                                {% else %}
                                                                    <option value="{{ loc.id }}" >{{ loc.nombre }}</option>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                        <label for="localidadHasta">Localidad Hasta</label>
                                                    </div>
                                                </div>                                    
                                            </div>
                                        </div>
                                        <div class="form-actions noborder flex">
                                            <button type="button" onclick="buscar()" class="btn green mg-r-10">Buscar</button>
                                            <button type="button" onclick="location.href='/sistema/listadoTarifario/';" class="btn btn-outline red">Volver</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- END EXAMPLE TABLE PORTLET-->
                        </div>
                        <div class="col-md-12">
                            <div class="portlet light ">
                                <div class="portlet-body">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                                            <div class="portlet light ">
                                                <div class="portlet-title">
                                                    <div class="caption font-blue">
                                                        <i class="icon-graph font-blue"></i>
                                                        <span class="caption-subject bold uppercase mg-r-20">Tramos Tarifarios</span>
                                                    </div>
                                                    <div class="tools"> </div>
                                                </div>
                                                <div class="portlet-body" id="divTablaTrayectoTramo">
                                                    <table class="table table-striped table-bordered table-hover dt-responsive" width="100%" id="tablaTramosTarifario">
                                                        <thead>
                                                            <tr>
                                                                <th class="">Tarifario</th>
                                                                <th class="">Desde</th>
                                                                <th class="">Hasta</th>
                                                                <th class="">STD</th>
                                                                <th class="">VIP</th>
                                                                <th class="">UTI</th>
                                                                <th class="">EJEC</th>
                                                                <th class="">VAN-C</th>
                                                                <th class="">VAN-L</th>
                                                                <th class="">MINI</th>
                                                                <th class="">BUS</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for trayecto in tramoTarifarioList %}
                                                            <tr>
                                                                <td>{{trayecto.tarifario.nombre}}</td>
                                                                <td>{{trayecto.desdeConcat}}</td>
                                                                <td>{{trayecto.hastaConcat}}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:1 }}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:2 }}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:3 }}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:4 }}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:5 }}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:6 }}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:7 }}</td>
                                                                <td>{{ trayecto|get_tarifa_by_cat:8 }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <!-- END EXAMPLE TABLE PORTLET-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
            <!-- BEGIN QUICK SIDEBAR -->
            <!-- END QUICK SIDEBAR -->
        </div>
        <!-- END CONTAINER -->
        {% include "sistema/footer.html" %}
            
        <!-- SCRIPTS PROPIOS DE ESTA VISTA -->
        <script>
            $(document).ready(function(){
                $(document).prop('title', 'Tramo Tarifario - Central LT');

                $('#tablaTramosTarifario').DataTable( {
                    responsive: true,
                    order: [[ 0, "asc" ]],
                    dom: 'lfBrtip',
                    buttons: [
                        {
                            extend: 'copy',
                        },
                        {
                            extend: 'excel',
                        },
                        {
                            extend: 'pdfHtml5',
                            orientation: 'landscape',
                            pageSize: 'LEGAL'
                        },
                        {
                            extend: 'print',
                        },
                    ],
                    lengthMenu: [
                                    [ 100, 50, 25, 10, -1 ],
                                    [ '100', '50', '25', '10', 'Todos' ]
                                ],
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json',
                        buttons: {
                            copy: "Copiar",
                            print: "Imprimir"
                        }
                    }
                    
                } );
            });

            function buscar(){
                if ($("#localidadDesde").val() == ""){
                    alert("El campo localidad desde es obligatorio.");
                    return false;
                }
                if ($("#localidadHasta").val() == ""){
                    alert("El campo localidad hasta es obligatorio.");
                    return false;
                }

                $("#formTramoTrayecto").submit();
            }

            function onchangeProvDesde(){
                var url = "/sistema/getLocalidadDesde/";
                param = 'idDesde='+$('#provinciaDesde').val()
                $.ajax({
                    type: "POST",
                    url: url,
                    headers: {'X-CSRFToken': '{{ csrf_token }}'},
                    data: param,
                    success: function(data){
                        $("#localidadDesdeSelect").html(data)
                    }
                });
            }

            function onchangeProvHasta(){
                var url = "/sistema/getLocalidadHasta/";
                param = 'idHasta='+$('#provinciaHasta').val()
                $.ajax({
                    type: "POST",
                    url: url,
                    headers: {'X-CSRFToken': '{{ csrf_token }}'},
                    data: param,
                    success: function(data){
                        $("#localidadHastaSelect").html(data)
                    }
                });
            }

        </script>

    </body>

</html>